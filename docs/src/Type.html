<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_9FzwewZwMRYLacBNlE6Q7H"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">findWithDefault</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Ast.html"><span class="hs-identifier">Ast</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Ast.html#Expr"><span class="hs-identifier">Expr</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ast.html#Name"><span class="hs-identifier">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ast.html#Pi"><span class="hs-identifier">Pi</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">runState</span></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>      </span><span class="annot"><span class="hs-identifier">MonadState</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">state</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>      </span><span class="annot"><span class="hs-identifier">State</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pi</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Graph</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">flattenSCC</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stronglyConnComp</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Foldable</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fold</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">newtype</span><span> </span><span id="FunId"><span class="annot"><a href="Type.html#FunId"><span class="hs-identifier hs-var">FunId</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="FunId"><span class="annot"><a href="Type.html#FunId"><span class="hs-identifier hs-var">FunId</span></a></span></span><span> </span><span class="annot"><a href="Ast.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679060397"><span id="local-6989586621679060399"><span class="annot"><span class="annottext">FunId -&gt; FunId -&gt; Bool
(FunId -&gt; FunId -&gt; Bool) -&gt; (FunId -&gt; FunId -&gt; Bool) -&gt; Eq FunId
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: FunId -&gt; FunId -&gt; Bool
$c/= :: FunId -&gt; FunId -&gt; Bool
== :: FunId -&gt; FunId -&gt; Bool
$c== :: FunId -&gt; FunId -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060381"><span id="local-6989586621679060383"><span id="local-6989586621679060385"><span id="local-6989586621679060387"><span id="local-6989586621679060389"><span id="local-6989586621679060391"><span id="local-6989586621679060393"><span class="annot"><span class="annottext">Eq FunId
Eq FunId
-&gt; (FunId -&gt; FunId -&gt; Ordering)
-&gt; (FunId -&gt; FunId -&gt; Bool)
-&gt; (FunId -&gt; FunId -&gt; Bool)
-&gt; (FunId -&gt; FunId -&gt; Bool)
-&gt; (FunId -&gt; FunId -&gt; Bool)
-&gt; (FunId -&gt; FunId -&gt; FunId)
-&gt; (FunId -&gt; FunId -&gt; FunId)
-&gt; Ord FunId
FunId -&gt; FunId -&gt; Bool
FunId -&gt; FunId -&gt; Ordering
FunId -&gt; FunId -&gt; FunId
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: FunId -&gt; FunId -&gt; FunId
$cmin :: FunId -&gt; FunId -&gt; FunId
max :: FunId -&gt; FunId -&gt; FunId
$cmax :: FunId -&gt; FunId -&gt; FunId
&gt;= :: FunId -&gt; FunId -&gt; Bool
$c&gt;= :: FunId -&gt; FunId -&gt; Bool
&gt; :: FunId -&gt; FunId -&gt; Bool
$c&gt; :: FunId -&gt; FunId -&gt; Bool
&lt;= :: FunId -&gt; FunId -&gt; Bool
$c&lt;= :: FunId -&gt; FunId -&gt; Bool
&lt; :: FunId -&gt; FunId -&gt; Bool
$c&lt; :: FunId -&gt; FunId -&gt; Bool
compare :: FunId -&gt; FunId -&gt; Ordering
$ccompare :: FunId -&gt; FunId -&gt; Ordering
$cp1Ord :: Eq FunId
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060374"><span id="local-6989586621679060376"><span id="local-6989586621679060378"><span class="annot"><span class="annottext">Int -&gt; FunId -&gt; ShowS
[FunId] -&gt; ShowS
FunId -&gt; String
(Int -&gt; FunId -&gt; ShowS)
-&gt; (FunId -&gt; String) -&gt; ([FunId] -&gt; ShowS) -&gt; Show FunId
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [FunId] -&gt; ShowS
$cshowList :: [FunId] -&gt; ShowS
show :: FunId -&gt; String
$cshow :: FunId -&gt; String
showsPrec :: Int -&gt; FunId -&gt; ShowS
$cshowsPrec :: Int -&gt; FunId -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">type</span><span> </span><span id="Ann"><span class="annot"><a href="Type.html#Ann"><span class="hs-identifier hs-var">Ann</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Type.html#FunId"><span class="hs-identifier hs-type">FunId</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">newtype</span><span> </span><span id="AnnVar"><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-var">AnnVar</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="AnnVar"><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-var">AnnVar</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679060368"><span id="local-6989586621679060370"><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Bool
(AnnVar -&gt; AnnVar -&gt; Bool)
-&gt; (AnnVar -&gt; AnnVar -&gt; Bool) -&gt; Eq AnnVar
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: AnnVar -&gt; AnnVar -&gt; Bool
$c/= :: AnnVar -&gt; AnnVar -&gt; Bool
== :: AnnVar -&gt; AnnVar -&gt; Bool
$c== :: AnnVar -&gt; AnnVar -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060353"><span id="local-6989586621679060355"><span id="local-6989586621679060357"><span id="local-6989586621679060359"><span id="local-6989586621679060361"><span id="local-6989586621679060363"><span id="local-6989586621679060365"><span class="annot"><span class="annottext">Eq AnnVar
Eq AnnVar
-&gt; (AnnVar -&gt; AnnVar -&gt; Ordering)
-&gt; (AnnVar -&gt; AnnVar -&gt; Bool)
-&gt; (AnnVar -&gt; AnnVar -&gt; Bool)
-&gt; (AnnVar -&gt; AnnVar -&gt; Bool)
-&gt; (AnnVar -&gt; AnnVar -&gt; Bool)
-&gt; (AnnVar -&gt; AnnVar -&gt; AnnVar)
-&gt; (AnnVar -&gt; AnnVar -&gt; AnnVar)
-&gt; Ord AnnVar
AnnVar -&gt; AnnVar -&gt; Bool
AnnVar -&gt; AnnVar -&gt; Ordering
AnnVar -&gt; AnnVar -&gt; AnnVar
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: AnnVar -&gt; AnnVar -&gt; AnnVar
$cmin :: AnnVar -&gt; AnnVar -&gt; AnnVar
max :: AnnVar -&gt; AnnVar -&gt; AnnVar
$cmax :: AnnVar -&gt; AnnVar -&gt; AnnVar
&gt;= :: AnnVar -&gt; AnnVar -&gt; Bool
$c&gt;= :: AnnVar -&gt; AnnVar -&gt; Bool
&gt; :: AnnVar -&gt; AnnVar -&gt; Bool
$c&gt; :: AnnVar -&gt; AnnVar -&gt; Bool
&lt;= :: AnnVar -&gt; AnnVar -&gt; Bool
$c&lt;= :: AnnVar -&gt; AnnVar -&gt; Bool
&lt; :: AnnVar -&gt; AnnVar -&gt; Bool
$c&lt; :: AnnVar -&gt; AnnVar -&gt; Bool
compare :: AnnVar -&gt; AnnVar -&gt; Ordering
$ccompare :: AnnVar -&gt; AnnVar -&gt; Ordering
$cp1Ord :: Eq AnnVar
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060347"><span id="local-6989586621679060349"><span id="local-6989586621679060351"><span class="annot"><span class="annottext">Int -&gt; AnnVar -&gt; ShowS
[AnnVar] -&gt; ShowS
AnnVar -&gt; String
(Int -&gt; AnnVar -&gt; ShowS)
-&gt; (AnnVar -&gt; String) -&gt; ([AnnVar] -&gt; ShowS) -&gt; Show AnnVar
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [AnnVar] -&gt; ShowS
$cshowList :: [AnnVar] -&gt; ShowS
show :: AnnVar -&gt; String
$cshow :: AnnVar -&gt; String
showsPrec :: Int -&gt; AnnVar -&gt; ShowS
$cshowsPrec :: Int -&gt; AnnVar -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">newtype</span><span> </span><span id="TyVar"><span class="annot"><a href="Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="TyVar"><span class="annot"><a href="Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679060342"><span id="local-6989586621679060344"><span class="annot"><span class="annottext">TyVar -&gt; TyVar -&gt; Bool
(TyVar -&gt; TyVar -&gt; Bool) -&gt; (TyVar -&gt; TyVar -&gt; Bool) -&gt; Eq TyVar
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: TyVar -&gt; TyVar -&gt; Bool
$c/= :: TyVar -&gt; TyVar -&gt; Bool
== :: TyVar -&gt; TyVar -&gt; Bool
$c== :: TyVar -&gt; TyVar -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060336"><span id="local-6989586621679060338"><span id="local-6989586621679060340"><span class="annot"><span class="annottext">Int -&gt; TyVar -&gt; ShowS
[TyVar] -&gt; ShowS
TyVar -&gt; String
(Int -&gt; TyVar -&gt; ShowS)
-&gt; (TyVar -&gt; String) -&gt; ([TyVar] -&gt; ShowS) -&gt; Show TyVar
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TyVar] -&gt; ShowS
$cshowList :: [TyVar] -&gt; ShowS
show :: TyVar -&gt; String
$cshow :: TyVar -&gt; String
showsPrec :: Int -&gt; TyVar -&gt; ShowS
$cshowsPrec :: Int -&gt; TyVar -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060321"><span id="local-6989586621679060323"><span id="local-6989586621679060325"><span id="local-6989586621679060327"><span id="local-6989586621679060329"><span id="local-6989586621679060331"><span id="local-6989586621679060333"><span class="annot"><span class="annottext">Eq TyVar
Eq TyVar
-&gt; (TyVar -&gt; TyVar -&gt; Ordering)
-&gt; (TyVar -&gt; TyVar -&gt; Bool)
-&gt; (TyVar -&gt; TyVar -&gt; Bool)
-&gt; (TyVar -&gt; TyVar -&gt; Bool)
-&gt; (TyVar -&gt; TyVar -&gt; Bool)
-&gt; (TyVar -&gt; TyVar -&gt; TyVar)
-&gt; (TyVar -&gt; TyVar -&gt; TyVar)
-&gt; Ord TyVar
TyVar -&gt; TyVar -&gt; Bool
TyVar -&gt; TyVar -&gt; Ordering
TyVar -&gt; TyVar -&gt; TyVar
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: TyVar -&gt; TyVar -&gt; TyVar
$cmin :: TyVar -&gt; TyVar -&gt; TyVar
max :: TyVar -&gt; TyVar -&gt; TyVar
$cmax :: TyVar -&gt; TyVar -&gt; TyVar
&gt;= :: TyVar -&gt; TyVar -&gt; Bool
$c&gt;= :: TyVar -&gt; TyVar -&gt; Bool
&gt; :: TyVar -&gt; TyVar -&gt; Bool
$c&gt; :: TyVar -&gt; TyVar -&gt; Bool
&lt;= :: TyVar -&gt; TyVar -&gt; Bool
$c&lt;= :: TyVar -&gt; TyVar -&gt; Bool
&lt; :: TyVar -&gt; TyVar -&gt; Bool
$c&lt; :: TyVar -&gt; TyVar -&gt; Bool
compare :: TyVar -&gt; TyVar -&gt; Ordering
$ccompare :: TyVar -&gt; TyVar -&gt; Ordering
$cp1Ord :: Eq TyVar
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- | A @Ty a@ represents a type with type annotations of type @a@.</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- A @TArrow t1 a b t2@ is the @t1 -&gt; t2@ function type, which may have been defined at program points in @a@, and may call functions defined at points in @b@.</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- The @TPair@ and @TList@ constructors respectively represent pairs and lists, where the @a@ annotation contains all locations they could have been created.</span><span>
</span><span id="line-30"></span><span class="hs-keyword">data</span><span> </span><span id="Ty"><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-var">Ty</span></a></span></span><span> </span><span id="local-6989586621679060500"><span class="annot"><a href="#local-6989586621679060500"><span class="hs-identifier hs-type">a</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span id="FreeVar"><span class="annot"><a href="Type.html#FreeVar"><span class="hs-identifier hs-var">FreeVar</span></a></span></span><span> </span><span class="annot"><a href="Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TInt"><span class="annot"><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TBool"><span class="annot"><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TArrow"><span class="annot"><a href="Type.html#TArrow"><span class="hs-identifier hs-var">TArrow</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060500"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679060500"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060500"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060500"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TPair"><span class="annot"><a href="Type.html#TPair"><span class="hs-identifier hs-var">TPair</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679060500"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060500"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060500"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TList"><span class="annot"><a href="Type.html#TList"><span class="hs-identifier hs-var">TList</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060500"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679060500"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679060309"><span id="local-6989586621679060311"><span id="local-6989586621679060313"><span class="annot"><span class="annottext">Int -&gt; Ty a -&gt; ShowS
[Ty a] -&gt; ShowS
Ty a -&gt; String
(Int -&gt; Ty a -&gt; ShowS)
-&gt; (Ty a -&gt; String) -&gt; ([Ty a] -&gt; ShowS) -&gt; Show (Ty a)
forall a. Show a =&gt; Int -&gt; Ty a -&gt; ShowS
forall a. Show a =&gt; [Ty a] -&gt; ShowS
forall a. Show a =&gt; Ty a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Ty a] -&gt; ShowS
$cshowList :: forall a. Show a =&gt; [Ty a] -&gt; ShowS
show :: Ty a -&gt; String
$cshow :: forall a. Show a =&gt; Ty a -&gt; String
showsPrec :: Int -&gt; Ty a -&gt; ShowS
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; Ty a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">data</span><span> </span><span id="TyScheme"><span class="annot"><a href="Type.html#TyScheme"><span class="hs-identifier hs-var">TyScheme</span></a></span></span><span> </span><span id="local-6989586621679060484"><span class="annot"><a href="#local-6989586621679060484"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SType"><span class="annot"><a href="Type.html#SType"><span class="hs-identifier hs-var">SType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060484"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Forall"><span class="annot"><a href="Type.html#Forall"><span class="hs-identifier hs-var">Forall</span></a></span></span><span> </span><span class="annot"><a href="Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TyScheme"><span class="hs-identifier hs-type">TyScheme</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060484"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679060301"><span id="local-6989586621679060303"><span id="local-6989586621679060305"><span class="annot"><span class="annottext">Int -&gt; TyScheme a -&gt; ShowS
[TyScheme a] -&gt; ShowS
TyScheme a -&gt; String
(Int -&gt; TyScheme a -&gt; ShowS)
-&gt; (TyScheme a -&gt; String)
-&gt; ([TyScheme a] -&gt; ShowS)
-&gt; Show (TyScheme a)
forall a. Show a =&gt; Int -&gt; TyScheme a -&gt; ShowS
forall a. Show a =&gt; [TyScheme a] -&gt; ShowS
forall a. Show a =&gt; TyScheme a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TyScheme a] -&gt; ShowS
$cshowList :: forall a. Show a =&gt; [TyScheme a] -&gt; ShowS
show :: TyScheme a -&gt; String
$cshow :: forall a. Show a =&gt; TyScheme a -&gt; String
showsPrec :: Int -&gt; TyScheme a -&gt; ShowS
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; TyScheme a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">type</span><span> </span><span id="TyEnv"><span class="annot"><a href="Type.html#TyEnv"><span class="hs-identifier hs-var">TyEnv</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Ast.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TyScheme"><span class="hs-identifier hs-type">TyScheme</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- | A @TySubst@ represents the composite substitution from type variables to types, and annotation variables to annotation variables.</span><span>
</span><span id="line-34"></span><span class="hs-keyword">data</span><span> </span><span id="TySubst"><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="TySubst"><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-comment">-- | A @Constr@ represents a relation between an annotation variable and either another variable, or a program point.</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- @Ni a pi@ expresses that @pi@ is in @a@, and @Super a b@ indicates that @a@ contains @b@.</span><span>
</span><span id="line-38"></span><span class="hs-keyword">data</span><span> </span><span id="Constr"><span class="annot"><a href="Type.html#Constr"><span class="hs-identifier hs-var">Constr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Ni"><span class="annot"><a href="Type.html#Ni"><span class="hs-identifier hs-var">Ni</span></a></span></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="annot"><a href="Type.html#FunId"><span class="hs-identifier hs-type">FunId</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Super"><span class="annot"><a href="Type.html#Super"><span class="hs-identifier hs-var">Super</span></a></span></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679060294"><span id="local-6989586621679060296"><span class="annot"><span class="annottext">Constr -&gt; Constr -&gt; Bool
(Constr -&gt; Constr -&gt; Bool)
-&gt; (Constr -&gt; Constr -&gt; Bool) -&gt; Eq Constr
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Constr -&gt; Constr -&gt; Bool
$c/= :: Constr -&gt; Constr -&gt; Bool
== :: Constr -&gt; Constr -&gt; Bool
$c== :: Constr -&gt; Constr -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060279"><span id="local-6989586621679060281"><span id="local-6989586621679060283"><span id="local-6989586621679060285"><span id="local-6989586621679060287"><span id="local-6989586621679060289"><span id="local-6989586621679060291"><span class="annot"><span class="annottext">Eq Constr
Eq Constr
-&gt; (Constr -&gt; Constr -&gt; Ordering)
-&gt; (Constr -&gt; Constr -&gt; Bool)
-&gt; (Constr -&gt; Constr -&gt; Bool)
-&gt; (Constr -&gt; Constr -&gt; Bool)
-&gt; (Constr -&gt; Constr -&gt; Bool)
-&gt; (Constr -&gt; Constr -&gt; Constr)
-&gt; (Constr -&gt; Constr -&gt; Constr)
-&gt; Ord Constr
Constr -&gt; Constr -&gt; Bool
Constr -&gt; Constr -&gt; Ordering
Constr -&gt; Constr -&gt; Constr
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: Constr -&gt; Constr -&gt; Constr
$cmin :: Constr -&gt; Constr -&gt; Constr
max :: Constr -&gt; Constr -&gt; Constr
$cmax :: Constr -&gt; Constr -&gt; Constr
&gt;= :: Constr -&gt; Constr -&gt; Bool
$c&gt;= :: Constr -&gt; Constr -&gt; Bool
&gt; :: Constr -&gt; Constr -&gt; Bool
$c&gt; :: Constr -&gt; Constr -&gt; Bool
&lt;= :: Constr -&gt; Constr -&gt; Bool
$c&lt;= :: Constr -&gt; Constr -&gt; Bool
&lt; :: Constr -&gt; Constr -&gt; Bool
$c&lt; :: Constr -&gt; Constr -&gt; Bool
compare :: Constr -&gt; Constr -&gt; Ordering
$ccompare :: Constr -&gt; Constr -&gt; Ordering
$cp1Ord :: Eq Constr
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060273"><span id="local-6989586621679060275"><span id="local-6989586621679060277"><span class="annot"><span class="annottext">Int -&gt; Constr -&gt; ShowS
[Constr] -&gt; ShowS
Constr -&gt; String
(Int -&gt; Constr -&gt; ShowS)
-&gt; (Constr -&gt; String) -&gt; ([Constr] -&gt; ShowS) -&gt; Show Constr
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Constr] -&gt; ShowS
$cshowList :: [Constr] -&gt; ShowS
show :: Constr -&gt; String
$cshow :: Constr -&gt; String
showsPrec :: Int -&gt; Constr -&gt; ShowS
$cshowsPrec :: Int -&gt; Constr -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">type</span><span> </span><span id="Constrs"><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-var">Constrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Type.html#Constr"><span class="hs-identifier hs-type">Constr</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">-- | Infer the type and annotation of a given (top-level) expression.</span><span>
</span><span id="line-42"></span><span class="annot"><a href="Type.html#typeOf"><span class="hs-identifier hs-type">typeOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ast.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TyScheme"><span class="hs-identifier hs-type">TyScheme</span></a></span><span> </span><span class="annot"><a href="Type.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span id="typeOf"><span class="annot"><span class="annottext">typeOf :: Expr -&gt; (TyScheme Ann, Ann)
</span><a href="Type.html#typeOf"><span class="hs-identifier hs-var hs-var">typeOf</span></a></span></span><span> </span><span id="local-6989586621679060271"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060271"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW%27"><span class="hs-identifier hs-var">ctaW'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060271"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060269"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060269"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060268"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060268"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060267"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060267"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">--traceShow cs $ traceShow s $ traceShow t $ traceShow eff</span><span>
</span><span id="line-45"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv -&gt; Ty Ann -&gt; TyScheme Ann
forall a. TyEnv -&gt; Ty a -&gt; TyScheme a
</span><a href="Type.html#generalise"><span class="hs-identifier hs-var">generalise</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Ty Ann -&gt; TyScheme Ann) -&gt; Ty Ann -&gt; TyScheme Ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AnnVar -&gt; Ann) -&gt; Ty AnnVar -&gt; Ty Ann
</span><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constrs -&gt; AnnVar -&gt; Ann
</span><a href="Type.html#solveConstraints"><span class="hs-identifier hs-var">solveConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060263"><span class="hs-identifier hs-var">cs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060262"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-46"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; AnnVar -&gt; Ann
</span><a href="Type.html#solveConstraints"><span class="hs-identifier hs-var">solveConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060263"><span class="hs-identifier hs-var">cs'</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060268"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679060261"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060261"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060263"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060263"><span class="hs-identifier hs-var">cs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; (TySubst, Constrs)
</span><a href="Type.html#simplify"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060267"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-49"></span><span>      </span><span id="local-6989586621679060262"><span class="annot"><span class="annottext">t' :: Ty AnnVar
</span><a href="#local-6989586621679060262"><span class="hs-identifier hs-var hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060261"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060269"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- | Run @ctaW@ on an expression.</span><span>
</span><span id="line-52"></span><span class="annot"><a href="Type.html#ctaW%27"><span class="hs-identifier hs-type">ctaW'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ast.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span id="ctaW%27"><span class="annot"><span class="annottext">ctaW' :: Expr -&gt; (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW%27"><span class="hs-identifier hs-var hs-var">ctaW'</span></a></span></span><span> </span><span id="local-6989586621679060258"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060258"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Ty AnnVar, AnnVar, TySubst, Constrs), Integer)
-&gt; (Ty AnnVar, AnnVar, TySubst, Constrs)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(((Ty AnnVar, AnnVar, TySubst, Constrs), Integer)
 -&gt; (Ty AnnVar, AnnVar, TySubst, Constrs))
-&gt; ((Ty AnnVar, AnnVar, TySubst, Constrs), Integer)
-&gt; (Ty AnnVar, AnnVar, TySubst, Constrs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; Integer -&gt; ((Ty AnnVar, AnnVar, TySubst, Constrs), Integer)
forall s a. State s a -&gt; s -&gt; (a, s)
</span><span class="hs-identifier hs-var">runState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060258"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">-- * algorithm W</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">-- | @ctaW@ implements algorithm W adapted to Call Tracking Analysis.</span><span>
</span><span id="line-58"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-type">ctaW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ast.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span id="ctaW"><span class="annot"><span class="annottext">ctaW :: TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var hs-var">ctaW</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#Integer"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar
forall a. Ty a
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">TySubst
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AnnVar -&gt; (Ty AnnVar, AnnVar, TySubst, Constrs))
-&gt; StateT Integer Identity AnnVar
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-60"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar
forall a. Ty a
</span><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">TySubst
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AnnVar -&gt; (Ty AnnVar, AnnVar, TySubst, Constrs))
-&gt; StateT Integer Identity AnnVar
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-61"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060252"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060252"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621679060250"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060250"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621679060249"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060249"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyScheme AnnVar -&gt; State Integer (Ty AnnVar)
</span><a href="Type.html#cfaInstantiate"><span class="hs-identifier hs-var">cfaInstantiate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyScheme AnnVar -&gt; String -&gt; TyEnv -&gt; TyScheme AnnVar
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">findWithDefault</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TyScheme AnnVar
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TyScheme AnnVar) -&gt; String -&gt; TyScheme AnnVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060250"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; not in environment &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TyEnv -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060252"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060250"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060252"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060249"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">TySubst
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AnnVar -&gt; (Ty AnnVar, AnnVar, TySubst, Constrs))
-&gt; StateT Integer Identity AnnVar
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-64"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060245"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060245"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#Fn"><span class="hs-identifier hs-type">Fn</span></a></span><span> </span><span id="local-6989586621679060243"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679060243"><span class="hs-identifier hs-var">pi</span></a></span></span><span> </span><span id="local-6989586621679060242"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060242"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679060241"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060241"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-65"></span><span>  </span><span id="local-6989586621679060240"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060240"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Integer (Ty AnnVar)
forall a. State Integer (Ty a)
</span><a href="Type.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060238"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060238"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060237"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060237"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060236"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060236"><span class="hs-identifier hs-var">th</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060235"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060235"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TyScheme AnnVar -&gt; TyEnv -&gt; TyEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060242"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar -&gt; TyScheme AnnVar
forall a. Ty a -&gt; TyScheme a
</span><a href="Type.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060240"><span class="hs-identifier hs-var">a1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060245"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060241"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span id="local-6989586621679060233"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060233"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span id="local-6989586621679060232"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060232"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TArrow"><span class="hs-identifier hs-var">TArrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060236"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060240"><span class="hs-identifier hs-var">a1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060233"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060237"><span class="hs-identifier hs-var">eff</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060238"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060232"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060236"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Integer -&gt; Constrs -&gt; Constrs
</span><a href="Type.html#annNi"><span class="hs-identifier hs-var">annNi</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060233"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679060243"><span class="hs-identifier hs-var">pi</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060235"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060230"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060230"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#Fun"><span class="hs-identifier hs-type">Fun</span></a></span><span> </span><span id="local-6989586621679060228"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679060228"><span class="hs-identifier hs-var">pi</span></a></span></span><span> </span><span id="local-6989586621679060227"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060227"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679060226"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060226"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679060225"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060225"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-71"></span><span>  </span><span id="local-6989586621679060224"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060224"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Integer (Ty AnnVar)
forall a. State Integer (Ty a)
</span><a href="Type.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span id="local-6989586621679060223"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060223"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Integer (Ty AnnVar)
forall a. State Integer (Ty a)
</span><a href="Type.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span id="local-6989586621679060222"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060222"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span id="local-6989586621679060221"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060221"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060220"><span class="annot"><span class="annottext">e' :: TyEnv
</span><a href="#local-6989586621679060220"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(String, TyScheme AnnVar)] -&gt; TyEnv
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060227"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; TyScheme AnnVar
forall a. Ty a -&gt; TyScheme a
</span><a href="Type.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty AnnVar -&gt; TyScheme AnnVar) -&gt; Ty AnnVar -&gt; TyScheme AnnVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TArrow"><span class="hs-identifier hs-var">TArrow</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060224"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060222"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060221"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060223"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060226"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; TyScheme AnnVar
forall a. Ty a -&gt; TyScheme a
</span><a href="Type.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060224"><span class="hs-identifier hs-var">a1</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TyEnv -&gt; TyEnv -&gt; TyEnv
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`M.union`</span></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060230"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060217"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060217"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060216"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060216"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060215"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060215"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060214"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060214"><span class="hs-identifier hs-var">c'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060220"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060225"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060213"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060213"><span class="hs-identifier hs-var">tau'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060212"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060212"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060217"><span class="hs-identifier hs-var">tau</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679060209"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060209"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060213"><span class="hs-identifier hs-var">tau'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060215"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060223"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060207"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679060207"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060209"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TySubst -&gt; TySubst
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060215"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TySubst -&gt; TySubst
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Map AnnVar AnnVar
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060221"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060216"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060205"><span class="annot"><span class="annottext">tau'' :: Ty AnnVar
</span><a href="#local-6989586621679060205"><span class="hs-identifier hs-var hs-var">tau''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TArrow"><span class="hs-identifier hs-var">TArrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060207"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060224"><span class="hs-identifier hs-var">a1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; AnnVar -&gt; AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060207"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060222"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; AnnVar -&gt; AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060207"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060216"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060207"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060213"><span class="hs-identifier hs-var">tau'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060204"><span class="annot"><span class="annottext">c2 :: Constrs
</span><a href="#local-6989586621679060204"><span class="hs-identifier hs-var hs-var">c2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060207"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Integer -&gt; Constrs -&gt; Constrs
</span><a href="Type.html#annNi"><span class="hs-identifier hs-var">annNi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; AnnVar -&gt; AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060207"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060222"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679060228"><span class="hs-identifier hs-var">pi</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060214"><span class="hs-identifier hs-var">c'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>  </span><span id="local-6989586621679060203"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060203"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060205"><span class="hs-identifier hs-var">tau''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060203"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060207"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060207"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060212"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; Constrs -&gt; Constrs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060204"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060202"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060202"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621679060200"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060200"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679060199"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060199"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060198"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060198"><span class="hs-identifier hs-var">tau1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060197"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060197"><span class="hs-identifier hs-var">eff1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060196"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060196"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060195"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060195"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060202"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060200"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060194"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060194"><span class="hs-identifier hs-var">tau2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060193"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060193"><span class="hs-identifier hs-var">eff2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060192"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060192"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060191"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060191"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; TyEnv -&gt; TyEnv
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060196"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060202"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060199"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span id="local-6989586621679060190"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060190"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Integer (Ty AnnVar)
forall a. State Integer (Ty a)
</span><a href="Type.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span id="local-6989586621679060189"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060189"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span id="local-6989586621679060188"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060188"><span class="hs-identifier hs-var">eff3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060187"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060187"><span class="hs-identifier hs-var">tau1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060186"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060186"><span class="hs-identifier hs-var">c3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060198"><span class="hs-identifier hs-var">tau1</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060185"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060185"><span class="hs-identifier hs-var">tau2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060184"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060184"><span class="hs-identifier hs-var">c4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060194"><span class="hs-identifier hs-var">tau2</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679060183"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060183"><span class="hs-identifier hs-var">th3</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060192"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060187"><span class="hs-identifier hs-var">tau1'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TArrow"><span class="hs-identifier hs-var">TArrow</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060185"><span class="hs-identifier hs-var">tau2'</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060189"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060188"><span class="hs-identifier hs-var">eff3</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060190"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060182"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679060182"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TySubst] -&gt; TySubst
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060183"><span class="hs-identifier hs-var">th3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060192"><span class="hs-identifier hs-var">th2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060196"><span class="hs-identifier hs-var">th1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060181"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060181"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060180"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060180"><span class="hs-identifier hs-var">c5</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[AnnVar] -&gt; State Integer (AnnVar, Constrs)
</span><a href="Type.html#annUnion"><span class="hs-identifier hs-var">annUnion</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060197"><span class="hs-identifier hs-var">eff1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060193"><span class="hs-identifier hs-var">eff2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060188"><span class="hs-identifier hs-var">eff3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060189"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060183"><span class="hs-identifier hs-var">th3</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060190"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060181"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060182"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060182"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Constrs] -&gt; Constrs
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060195"><span class="hs-identifier hs-var">c1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060191"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060186"><span class="hs-identifier hs-var">c3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060184"><span class="hs-identifier hs-var">c4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060180"><span class="hs-identifier hs-var">c5</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060178"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060178"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621679060176"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060176"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679060175"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060175"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679060174"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060174"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060173"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060173"><span class="hs-identifier hs-var">tau1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060172"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060172"><span class="hs-identifier hs-var">eff1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060171"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060171"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060170"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060170"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060178"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060175"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060169"><span class="annot"><span class="annottext">e' :: TyEnv
</span><a href="#local-6989586621679060169"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Ty AnnVar -&gt; TyEnv -&gt; TyEnv
</span><a href="Type.html#genIn"><span class="hs-identifier hs-var">genIn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060176"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060173"><span class="hs-identifier hs-var">tau1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; TyEnv -&gt; TyEnv
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060171"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060178"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060167"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060167"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060166"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060166"><span class="hs-identifier hs-var">eff2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060165"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060165"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060164"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060164"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060169"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060174"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060163"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679060163"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060165"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TySubst -&gt; TySubst
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060171"><span class="hs-identifier hs-var">th1</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060162"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060162"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060161"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060161"><span class="hs-identifier hs-var">c3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[AnnVar] -&gt; State Integer (AnnVar, Constrs)
</span><a href="Type.html#annUnion"><span class="hs-identifier hs-var">annUnion</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060172"><span class="hs-identifier hs-var">eff1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060166"><span class="hs-identifier hs-var">eff2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060167"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060162"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060163"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060163"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060170"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; Constrs -&gt; Constrs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060164"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; Constrs -&gt; Constrs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060161"><span class="hs-identifier hs-var">c3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060160"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060160"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#ITE"><span class="hs-identifier hs-type">ITE</span></a></span><span> </span><span id="local-6989586621679060158"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060158"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679060157"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060157"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621679060156"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060156"><span class="hs-identifier hs-var">t3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060155"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060155"><span class="hs-identifier hs-var">tau1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060154"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060154"><span class="hs-identifier hs-var">eff1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060153"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060153"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060152"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060152"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060160"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060158"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060151"><span class="annot"><span class="annottext">e1 :: TyEnv
</span><a href="#local-6989586621679060151"><span class="hs-identifier hs-var hs-var">e1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TyEnv -&gt; TyEnv
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060153"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060160"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060150"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060150"><span class="hs-identifier hs-var">tau2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060149"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060149"><span class="hs-identifier hs-var">eff2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060148"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060148"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060147"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060147"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060151"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060157"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060146"><span class="annot"><span class="annottext">e2 :: TyEnv
</span><a href="#local-6989586621679060146"><span class="hs-identifier hs-var hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TyEnv -&gt; TyEnv
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060148"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060151"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060145"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060145"><span class="hs-identifier hs-var">tau3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060144"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060144"><span class="hs-identifier hs-var">eff3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060143"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060143"><span class="hs-identifier hs-var">th3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060142"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060142"><span class="hs-identifier hs-var">c3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060146"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060156"><span class="hs-identifier hs-var">t3</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060141"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060141"><span class="hs-identifier hs-var">th4</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060140"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060140"><span class="hs-identifier hs-var">c4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
-&gt; Ty AnnVar -&gt; State Integer (TySubst, Ty AnnVar, Constrs)
</span><a href="Type.html#subUnify"><span class="hs-identifier hs-var">subUnify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060143"><span class="hs-identifier hs-var">th3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060148"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060155"><span class="hs-identifier hs-var">tau1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
forall a. Ty a
</span><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060138"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060138"><span class="hs-identifier hs-var">th5</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060137"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060137"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060136"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060136"><span class="hs-identifier hs-var">c5</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
-&gt; Ty AnnVar -&gt; State Integer (TySubst, Ty AnnVar, Constrs)
</span><a href="Type.html#subUnify"><span class="hs-identifier hs-var">subUnify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060141"><span class="hs-identifier hs-var">th4</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060143"><span class="hs-identifier hs-var">th3</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060150"><span class="hs-identifier hs-var">tau2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060141"><span class="hs-identifier hs-var">th4</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060145"><span class="hs-identifier hs-var">tau3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060135"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679060135"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TySubst] -&gt; TySubst
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060138"><span class="hs-identifier hs-var">th5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060141"><span class="hs-identifier hs-var">th4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060143"><span class="hs-identifier hs-var">th3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060148"><span class="hs-identifier hs-var">th2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060153"><span class="hs-identifier hs-var">th1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060134"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060134"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060133"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060133"><span class="hs-identifier hs-var">c6</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[AnnVar] -&gt; State Integer (AnnVar, Constrs)
</span><a href="Type.html#annUnion"><span class="hs-identifier hs-var">annUnion</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060154"><span class="hs-identifier hs-var">eff1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060149"><span class="hs-identifier hs-var">eff2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060144"><span class="hs-identifier hs-var">eff3</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060137"><span class="hs-identifier hs-var">t'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060134"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060135"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060135"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Constrs] -&gt; Constrs
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">S.unions</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060152"><span class="hs-identifier hs-var">c1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060147"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060142"><span class="hs-identifier hs-var">c3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060140"><span class="hs-identifier hs-var">c4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060136"><span class="hs-identifier hs-var">c5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060133"><span class="hs-identifier hs-var">c6</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060131"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060131"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#Oper"><span class="hs-identifier hs-type">Oper</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679060129"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060129"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679060128"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060128"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060127"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060127"><span class="hs-identifier hs-var">tau1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060126"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060126"><span class="hs-identifier hs-var">eff1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060125"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060125"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060124"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060124"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060131"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060129"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060123"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060123"><span class="hs-identifier hs-var">tau2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060122"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060122"><span class="hs-identifier hs-var">eff2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060121"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060121"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060120"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060120"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; TyEnv -&gt; TyEnv
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060125"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060131"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060128"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060119"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060119"><span class="hs-identifier hs-var">th3</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060118"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060118"><span class="hs-identifier hs-var">c3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
-&gt; Ty AnnVar -&gt; State Integer (TySubst, Ty AnnVar, Constrs)
</span><a href="Type.html#subUnify"><span class="hs-identifier hs-var">subUnify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060121"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060127"><span class="hs-identifier hs-var">tau1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
forall a. Ty a
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060117"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060117"><span class="hs-identifier hs-var">th4</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060116"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060116"><span class="hs-identifier hs-var">c4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
-&gt; Ty AnnVar -&gt; State Integer (TySubst, Ty AnnVar, Constrs)
</span><a href="Type.html#subUnify"><span class="hs-identifier hs-var">subUnify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060119"><span class="hs-identifier hs-var">th3</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060123"><span class="hs-identifier hs-var">tau2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
forall a. Ty a
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060115"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679060115"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TySubst] -&gt; TySubst
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060117"><span class="hs-identifier hs-var">th4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060119"><span class="hs-identifier hs-var">th3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060121"><span class="hs-identifier hs-var">th2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060125"><span class="hs-identifier hs-var">th1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060114"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060114"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060113"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060113"><span class="hs-identifier hs-var">c5</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[AnnVar] -&gt; State Integer (AnnVar, Constrs)
</span><a href="Type.html#annUnion"><span class="hs-identifier hs-var">annUnion</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060126"><span class="hs-identifier hs-var">eff1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060122"><span class="hs-identifier hs-var">eff2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar
forall a. Ty a
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060114"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060115"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060115"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Constrs] -&gt; Constrs
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">S.unions</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060124"><span class="hs-identifier hs-var">c1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060120"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060118"><span class="hs-identifier hs-var">c3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060116"><span class="hs-identifier hs-var">c4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060113"><span class="hs-identifier hs-var">c5</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060112"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060112"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#Pair"><span class="hs-identifier hs-type">Pair</span></a></span><span> </span><span id="local-6989586621679060110"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679060110"><span class="hs-identifier hs-var">pi</span></a></span></span><span> </span><span id="local-6989586621679060109"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060109"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679060108"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060108"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060107"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060107"><span class="hs-identifier hs-var">tau1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060106"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060106"><span class="hs-identifier hs-var">eff1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060105"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060105"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060104"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060104"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060112"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060109"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060103"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060103"><span class="hs-identifier hs-var">tau2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060102"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060102"><span class="hs-identifier hs-var">eff2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060101"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060101"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060100"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060100"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; TyEnv -&gt; TyEnv
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060105"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060112"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060108"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621679060099"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060099"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060098"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679060098"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060101"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TySubst -&gt; TySubst
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060105"><span class="hs-identifier hs-var">th1</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060097"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060097"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060096"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060096"><span class="hs-identifier hs-var">c3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[AnnVar] -&gt; State Integer (AnnVar, Constrs)
</span><a href="Type.html#annUnion"><span class="hs-identifier hs-var">annUnion</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060106"><span class="hs-identifier hs-var">eff1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060102"><span class="hs-identifier hs-var">eff2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. a -&gt; Ty a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TPair"><span class="hs-identifier hs-var">TPair</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060099"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060101"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060107"><span class="hs-identifier hs-var">tau1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060103"><span class="hs-identifier hs-var">tau2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060097"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060098"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060101"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Integer -&gt; Constrs -&gt; Constrs
</span><a href="Type.html#annNi"><span class="hs-identifier hs-var">annNi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; AnnVar -&gt; AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060098"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060099"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679060110"><span class="hs-identifier hs-var">pi</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060104"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; Constrs -&gt; Constrs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060100"><span class="hs-identifier hs-var">c2</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; Constrs -&gt; Constrs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060096"><span class="hs-identifier hs-var">c3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060095"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060095"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#PCase"><span class="hs-identifier hs-type">PCase</span></a></span><span> </span><span id="local-6989586621679060093"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060093"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679060092"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060092"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679060091"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060091"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679060090"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060090"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060089"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060089"><span class="hs-identifier hs-var">tau1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060088"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060088"><span class="hs-identifier hs-var">eff1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060087"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060087"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060086"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060086"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060095"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060093"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span id="local-6989586621679060085"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060085"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Integer (Ty AnnVar)
forall a. State Integer (Ty a)
</span><a href="Type.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span id="local-6989586621679060084"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060084"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Integer (Ty AnnVar)
forall a. State Integer (Ty a)
</span><a href="Type.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span>
</span><span id="line-133"></span><span>  </span><span id="local-6989586621679060083"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060083"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060082"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060082"><span class="hs-identifier hs-var">tau1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060081"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060081"><span class="hs-identifier hs-var">c4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060089"><span class="hs-identifier hs-var">tau1</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679060080"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060080"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. a -&gt; Ty a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TPair"><span class="hs-identifier hs-var">TPair</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060083"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060085"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060084"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060082"><span class="hs-identifier hs-var">tau1'</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060079"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679060079"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060080"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TySubst -&gt; TySubst
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060087"><span class="hs-identifier hs-var">th1</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060078"><span class="annot"><span class="annottext">e' :: TyEnv
</span><a href="#local-6989586621679060078"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Ty AnnVar -&gt; TyEnv -&gt; TyEnv
</span><a href="Type.html#genIn"><span class="hs-identifier hs-var">genIn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060092"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060079"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060085"><span class="hs-identifier hs-var">a1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TyEnv -&gt; TyEnv) -&gt; TyEnv -&gt; TyEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Ty AnnVar -&gt; TyEnv -&gt; TyEnv
</span><a href="Type.html#genIn"><span class="hs-identifier hs-var">genIn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060091"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060079"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060084"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TyEnv -&gt; TyEnv) -&gt; TyEnv -&gt; TyEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TyEnv -&gt; TyEnv
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060079"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060095"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060077"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060077"><span class="hs-identifier hs-var">tau2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060076"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060076"><span class="hs-identifier hs-var">eff2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060075"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060075"><span class="hs-identifier hs-var">th3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060074"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060074"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060078"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060090"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060073"><span class="annot"><span class="annottext">th' :: TySubst
</span><a href="#local-6989586621679060073"><span class="hs-identifier hs-var hs-var">th'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060075"><span class="hs-identifier hs-var">th3</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TySubst -&gt; TySubst
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060079"><span class="hs-identifier hs-var">th</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060072"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060072"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060071"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060071"><span class="hs-identifier hs-var">c3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[AnnVar] -&gt; State Integer (AnnVar, Constrs)
</span><a href="Type.html#annUnion"><span class="hs-identifier hs-var">annUnion</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060088"><span class="hs-identifier hs-var">eff1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060076"><span class="hs-identifier hs-var">eff2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060077"><span class="hs-identifier hs-var">tau2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060072"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060073"><span class="hs-identifier hs-var">th'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060073"><span class="hs-identifier hs-var">th'</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Constrs] -&gt; Constrs
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060086"><span class="hs-identifier hs-var">c1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060074"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060071"><span class="hs-identifier hs-var">c3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060081"><span class="hs-identifier hs-var">c4</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#Nil"><span class="hs-identifier hs-type">Nil</span></a></span><span> </span><span id="local-6989586621679060069"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679060069"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-143"></span><span>  </span><span id="local-6989586621679060068"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060068"><span class="hs-identifier hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Integer (Ty AnnVar)
forall a. State Integer (Ty a)
</span><a href="Type.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span id="local-6989586621679060067"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060067"><span class="hs-identifier hs-var">eff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span id="local-6989586621679060066"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060066"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; Ty a
</span><a href="Type.html#TList"><span class="hs-identifier hs-var">TList</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060068"><span class="hs-identifier hs-var">tau</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060066"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060067"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Integer -&gt; Constrs -&gt; Constrs
</span><a href="Type.html#annNi"><span class="hs-identifier hs-var">annNi</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060066"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679060069"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060065"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060065"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#Cons"><span class="hs-identifier hs-type">Cons</span></a></span><span> </span><span id="local-6989586621679060063"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679060063"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679060062"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060062"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679060061"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060061"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060060"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060060"><span class="hs-identifier hs-var">tau1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060059"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060059"><span class="hs-identifier hs-var">eff1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060058"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060058"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060057"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060057"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060065"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060062"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060056"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060056"><span class="hs-identifier hs-var">tau2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060055"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060055"><span class="hs-identifier hs-var">eff2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060054"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060054"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060053"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060053"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; TyEnv -&gt; TyEnv
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060058"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060065"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060061"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621679060052"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060052"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060051"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060051"><span class="hs-identifier hs-var">tau1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060050"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060050"><span class="hs-identifier hs-var">c4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060060"><span class="hs-identifier hs-var">tau1</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060049"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060049"><span class="hs-identifier hs-var">tau2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060048"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060048"><span class="hs-identifier hs-var">c5</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060056"><span class="hs-identifier hs-var">tau2</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679060047"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060047"><span class="hs-identifier hs-var">th3</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; Ty a
</span><a href="Type.html#TList"><span class="hs-identifier hs-var">TList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060054"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060051"><span class="hs-identifier hs-var">tau1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060052"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060049"><span class="hs-identifier hs-var">tau2'</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060046"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679060046"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TySubst] -&gt; TySubst
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060047"><span class="hs-identifier hs-var">th3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060054"><span class="hs-identifier hs-var">th2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060058"><span class="hs-identifier hs-var">th1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621679060045"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060045"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621679060044"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060044"><span class="hs-identifier hs-var">eff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060043"><span class="annot"><span class="annottext">c3 :: Constrs
</span><a href="#local-6989586621679060043"><span class="hs-identifier hs-var hs-var">c3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Integer -&gt; Constrs -&gt; Constrs
</span><a href="Type.html#annNi"><span class="hs-identifier hs-var">annNi</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060045"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679060063"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Constr] -&gt; Constrs
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#Super"><span class="hs-identifier hs-var">Super</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060044"><span class="hs-identifier hs-var">eff</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060059"><span class="hs-identifier hs-var">eff1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#Super"><span class="hs-identifier hs-var">Super</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060044"><span class="hs-identifier hs-var">eff</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060055"><span class="hs-identifier hs-var">eff2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#Super"><span class="hs-identifier hs-var">Super</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060045"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060052"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; Ty a
</span><a href="Type.html#TList"><span class="hs-identifier hs-var">TList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060046"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060051"><span class="hs-identifier hs-var">tau1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060045"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060044"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060046"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060046"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Constrs] -&gt; Constrs
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060057"><span class="hs-identifier hs-var">c1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060053"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060043"><span class="hs-identifier hs-var">c3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060050"><span class="hs-identifier hs-var">c4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060048"><span class="hs-identifier hs-var">c5</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span class="annot"><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span id="local-6989586621679060041"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060041"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ast.html#LCase"><span class="hs-identifier hs-type">LCase</span></a></span><span> </span><span id="local-6989586621679060039"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060039"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679060038"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060038"><span class="hs-identifier hs-var">hd</span></a></span></span><span> </span><span id="local-6989586621679060037"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060037"><span class="hs-identifier hs-var">tl</span></a></span></span><span> </span><span id="local-6989586621679060036"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060036"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621679060035"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060035"><span class="hs-identifier hs-var">t3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060034"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060034"><span class="hs-identifier hs-var">tau1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060033"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060033"><span class="hs-identifier hs-var">eff1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060032"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060032"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060031"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060031"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060041"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060039"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621679060030"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060030"><span class="hs-identifier hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Integer (Ty AnnVar)
forall a. State Integer (Ty a)
</span><a href="Type.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span id="local-6989586621679060029"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060029"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060028"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060028"><span class="hs-identifier hs-var">tau'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060027"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060027"><span class="hs-identifier hs-var">c6</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060030"><span class="hs-identifier hs-var">tau</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060026"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060026"><span class="hs-identifier hs-var">tau1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060025"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060025"><span class="hs-identifier hs-var">c7</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060034"><span class="hs-identifier hs-var">tau1</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679060024"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060024"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; Ty a
</span><a href="Type.html#TList"><span class="hs-identifier hs-var">TList</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060028"><span class="hs-identifier hs-var">tau'</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060029"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060026"><span class="hs-identifier hs-var">tau1'</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060023"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679060023"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060024"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TySubst -&gt; TySubst
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060032"><span class="hs-identifier hs-var">th1</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060022"><span class="annot"><span class="annottext">e' :: TyEnv
</span><a href="#local-6989586621679060022"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Ty AnnVar -&gt; TyEnv -&gt; TyEnv
</span><a href="Type.html#genIn"><span class="hs-identifier hs-var">genIn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060038"><span class="hs-identifier hs-var">hd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060023"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060028"><span class="hs-identifier hs-var">tau'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TyEnv -&gt; TyEnv) -&gt; TyEnv -&gt; TyEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Ty AnnVar -&gt; TyEnv -&gt; TyEnv
</span><a href="Type.html#genIn"><span class="hs-identifier hs-var">genIn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679060037"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060023"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060026"><span class="hs-identifier hs-var">tau1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TyEnv -&gt; TyEnv) -&gt; TyEnv -&gt; TyEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TyEnv -&gt; TyEnv
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060023"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060041"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060021"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060021"><span class="hs-identifier hs-var">tau2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060020"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060020"><span class="hs-identifier hs-var">eff2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060019"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060019"><span class="hs-identifier hs-var">th3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060018"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060018"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060022"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060036"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060017"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060017"><span class="hs-identifier hs-var">tau3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060016"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060016"><span class="hs-identifier hs-var">eff3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060015"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060015"><span class="hs-identifier hs-var">th4</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060014"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060014"><span class="hs-identifier hs-var">c3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyEnv
-&gt; Expr -&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
</span><a href="Type.html#ctaW"><span class="hs-identifier hs-var">ctaW</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679060041"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621679060035"><span class="hs-identifier hs-var">t3</span></a></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060013"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060013"><span class="hs-identifier hs-var">th5</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060012"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060012"><span class="hs-identifier hs-var">tau4</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060011"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060011"><span class="hs-identifier hs-var">c4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
-&gt; Ty AnnVar -&gt; State Integer (TySubst, Ty AnnVar, Constrs)
</span><a href="Type.html#subUnify"><span class="hs-identifier hs-var">subUnify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060015"><span class="hs-identifier hs-var">th4</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060021"><span class="hs-identifier hs-var">tau2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060017"><span class="hs-identifier hs-var">tau3</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679060010"><span class="annot"><span class="annottext">th' :: TySubst
</span><a href="#local-6989586621679060010"><span class="hs-identifier hs-var hs-var">th'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TySubst] -&gt; TySubst
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060013"><span class="hs-identifier hs-var">th5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060019"><span class="hs-identifier hs-var">th3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060023"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060009"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060009"><span class="hs-identifier hs-var">eff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060008"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060008"><span class="hs-identifier hs-var">c5</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[AnnVar] -&gt; State Integer (AnnVar, Constrs)
</span><a href="Type.html#annUnion"><span class="hs-identifier hs-var">annUnion</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060033"><span class="hs-identifier hs-var">eff1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060020"><span class="hs-identifier hs-var">eff2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060016"><span class="hs-identifier hs-var">eff3</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, AnnVar, TySubst, Constrs)
-&gt; State Integer (Ty AnnVar, AnnVar, TySubst, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060012"><span class="hs-identifier hs-var">tau4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679060009"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060010"><span class="hs-identifier hs-var">th'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060010"><span class="hs-identifier hs-var">th'</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Constrs] -&gt; Constrs
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060031"><span class="hs-identifier hs-var">c1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060018"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060014"><span class="hs-identifier hs-var">c3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060011"><span class="hs-identifier hs-var">c4</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060008"><span class="hs-identifier hs-var">c5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060027"><span class="hs-identifier hs-var">c6</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060025"><span class="hs-identifier hs-var">c7</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- * subtyping</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | Unify the subtypes of the argument types.</span><span>
</span><span id="line-178"></span><span class="annot"><a href="Type.html#subUnify"><span class="hs-identifier hs-type">subUnify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span id="subUnify"><span class="annot"><span class="annottext">subUnify :: Ty AnnVar
-&gt; Ty AnnVar -&gt; State Integer (TySubst, Ty AnnVar, Constrs)
</span><a href="Type.html#subUnify"><span class="hs-identifier hs-var hs-var">subUnify</span></a></span></span><span> </span><span id="local-6989586621679060007"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060007"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679060006"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060006"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060005"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060005"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060004"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060004"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060007"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679060003"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060003"><span class="hs-identifier hs-var">b'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060002"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060002"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060006"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679060001"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060001"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679060000"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060000"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060005"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060003"><span class="hs-identifier hs-var">b'</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><span class="annottext">(TySubst, Ty AnnVar, Constrs)
-&gt; State Integer (TySubst, Ty AnnVar, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679060001"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679060000"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060004"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; Constrs -&gt; Constrs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679060002"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- | Create a subtype of the given type.</span><span>
</span><span id="line-186"></span><span class="annot"><a href="Type.html#subtype"><span class="hs-identifier hs-type">subtype</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Variance"><span class="hs-identifier hs-type">Variance</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span id="subtype"><span class="annot"><span class="annottext">subtype :: Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var hs-var">subtype</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TArrow"><span class="hs-identifier hs-type">TArrow</span></a></span><span> </span><span id="local-6989586621679059999"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059999"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059998"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059998"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059997"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059997"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679059996"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059996"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059995"><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059995"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679059994"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059994"><span class="hs-identifier hs-var">t1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059993"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059993"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059999"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Variance -&gt; Variance
</span><a href="Type.html#op"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059995"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621679059991"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059991"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621679059990"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059990"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679059989"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059989"><span class="hs-identifier hs-var">t2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059988"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059988"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059996"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059995"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, Constrs) -&gt; State Integer (Ty AnnVar, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TArrow"><span class="hs-identifier hs-var">TArrow</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059994"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059991"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059990"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059989"><span class="hs-identifier hs-var">t2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Constrs -&gt; Constrs
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Variance -&gt; AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#variance"><span class="hs-identifier hs-var">variance</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059995"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059998"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059991"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Constrs -&gt; Constrs
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Variance -&gt; AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#variance"><span class="hs-identifier hs-var">variance</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059995"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059997"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059990"><span class="hs-identifier hs-var">b'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059993"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; Constrs -&gt; Constrs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059988"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span class="annot"><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TPair"><span class="hs-identifier hs-type">TPair</span></a></span><span> </span><span id="local-6989586621679059985"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059985"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059984"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059984"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059983"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059983"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059982"><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059982"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>  </span><span id="local-6989586621679059981"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059981"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679059980"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059980"><span class="hs-identifier hs-var">t1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059979"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059979"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059984"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059982"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679059978"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059978"><span class="hs-identifier hs-var">t2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059977"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059977"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059983"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059982"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, Constrs) -&gt; State Integer (Ty AnnVar, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. a -&gt; Ty a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TPair"><span class="hs-identifier hs-var">TPair</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059981"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059980"><span class="hs-identifier hs-var">t1'</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059978"><span class="hs-identifier hs-var">t2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Constrs -&gt; Constrs
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Variance -&gt; AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#variance"><span class="hs-identifier hs-var">variance</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059982"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059985"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059981"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059979"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; Constrs -&gt; Constrs
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059977"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span class="annot"><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TList"><span class="hs-identifier hs-type">TList</span></a></span><span> </span><span id="local-6989586621679059976"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059976"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679059975"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059975"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059974"><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059974"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621679059973"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059973"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679059972"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059972"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059971"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059971"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)
</span><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059976"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059974"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><span class="annottext">(Ty AnnVar, Constrs) -&gt; State Integer (Ty AnnVar, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; Ty a
</span><a href="Type.html#TList"><span class="hs-identifier hs-var">TList</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059972"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059973"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Constrs -&gt; Constrs
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Variance -&gt; AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#variance"><span class="hs-identifier hs-var">variance</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="#local-6989586621679059974"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059975"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059973"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059971"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span class="annot"><a href="Type.html#subtype"><span class="hs-identifier hs-var">subtype</span></a></span><span> </span><span id="local-6989586621679059970"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059970"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Variance
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ty AnnVar, Constrs) -&gt; State Integer (Ty AnnVar, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059970"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- -- | Create a subeffected type of a given type.</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- subtype :: Ty AnnVar -&gt; Variance -&gt; State Integer (Ty AnnVar, Constrs)</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- subtype (TArrow t1 a b t2) v = do</span><span>
</span><span id="line-207"></span><span class="hs-comment">--   a' &lt;- freshAnnVar</span><span>
</span><span id="line-208"></span><span class="hs-comment">--   b' &lt;- freshAnnVar</span><span>
</span><span id="line-209"></span><span class="hs-comment">--   return (TArrow t1 a' b' t2, S.insert (variance v a a') $ S.insert (variance v b b') $ mempty)</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- subtype (TPair a t1 t2) v = do</span><span>
</span><span id="line-211"></span><span class="hs-comment">--   b &lt;- freshAnnVar</span><span>
</span><span id="line-212"></span><span class="hs-comment">--   return (TPair b t1 t2, S.insert (variance v a b) $ mempty)</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- subtype (TList t a) v = do</span><span>
</span><span id="line-214"></span><span class="hs-comment">--   b &lt;- freshAnnVar</span><span>
</span><span id="line-215"></span><span class="hs-comment">--   return (TList t b, S.insert (variance v a b) mempty)</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- subtype x _ = return (x, mempty)</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- | A @Variance@ tracks the polarity of locations in types.</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- For an arrow @t1 -&gt; t2@ in positive position, @t1@ is negative, and vice versa.</span><span>
</span><span id="line-220"></span><span class="hs-keyword">data</span><span> </span><span id="Variance"><span class="annot"><a href="Type.html#Variance"><span class="hs-identifier hs-var">Variance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Co"><span class="annot"><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Contra"><span class="annot"><a href="Type.html#Contra"><span class="hs-identifier hs-var">Contra</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679059965"><span id="local-6989586621679059967"><span class="annot"><span class="annottext">Variance -&gt; Variance -&gt; Bool
(Variance -&gt; Variance -&gt; Bool)
-&gt; (Variance -&gt; Variance -&gt; Bool) -&gt; Eq Variance
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Variance -&gt; Variance -&gt; Bool
$c/= :: Variance -&gt; Variance -&gt; Bool
== :: Variance -&gt; Variance -&gt; Bool
$c== :: Variance -&gt; Variance -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="annot"><a href="Type.html#op"><span class="hs-identifier hs-type">op</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#Variance"><span class="hs-identifier hs-type">Variance</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Variance"><span class="hs-identifier hs-type">Variance</span></a></span><span>
</span><span id="line-223"></span><span id="op"><span class="annot"><span class="annottext">op :: Variance -&gt; Variance
</span><a href="Type.html#op"><span class="hs-identifier hs-var hs-var">op</span></a></span></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Contra"><span class="hs-identifier hs-var">Contra</span></a></span><span>
</span><span id="line-224"></span><span class="annot"><a href="Type.html#op"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Contra"><span class="hs-identifier hs-var">Contra</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-comment">-- | If @a@ and @b@ occur in the same location in @t1@ and @t2@ respectively,</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- return the necessary constraint to maintain @t1 &lt;= t2@.</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- This means that if @a@ is covariant or positive, we return @a &lt;= b@,</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- and @b &lt;= a@ if it is contravariant or negative.</span><span>
</span><span id="line-230"></span><span class="annot"><a href="Type.html#variance"><span class="hs-identifier hs-type">variance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#Variance"><span class="hs-identifier hs-type">Variance</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Constr"><span class="hs-identifier hs-type">Constr</span></a></span><span>
</span><span id="line-231"></span><span id="variance"><span class="annot"><span class="annottext">variance :: Variance -&gt; AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#variance"><span class="hs-identifier hs-var hs-var">variance</span></a></span></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Co"><span class="hs-identifier hs-var">Co</span></a></span><span>     </span><span id="local-6989586621679059964"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059964"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059963"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059963"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#Super"><span class="hs-identifier hs-var">Super</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059963"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059964"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-232"></span><span class="annot"><a href="Type.html#variance"><span class="hs-identifier hs-var">variance</span></a></span><span> </span><span class="annot"><span class="annottext">Variance
</span><a href="Type.html#Contra"><span class="hs-identifier hs-var">Contra</span></a></span><span> </span><span id="local-6989586621679059962"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059962"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059961"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059961"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#Super"><span class="hs-identifier hs-var">Super</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059962"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059961"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-comment">-- * unification</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-- | Unify two types, returning the substition and unified type.</span><span>
</span><span id="line-237"></span><span class="annot"><a href="Type.html#unify"><span class="hs-identifier hs-type">unify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span id="unify"><span class="annot"><span class="annottext">unify :: Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var hs-var">unify</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
forall a. Ty a
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span class="annot"><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
forall a. Ty a
</span><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span class="annot"><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TPair"><span class="hs-identifier hs-type">TPair</span></a></span><span> </span><span id="local-6989586621679059960"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059960"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621679059959"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059959"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059958"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059958"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TPair"><span class="hs-identifier hs-type">TPair</span></a></span><span> </span><span id="local-6989586621679059957"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059957"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621679059956"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059956"><span class="hs-identifier hs-var">t3</span></a></span></span><span> </span><span id="local-6989586621679059955"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059955"><span class="hs-identifier hs-var">t4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TySubst] -&gt; TySubst
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059954"><span class="hs-identifier hs-var">th2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059953"><span class="hs-identifier hs-var">th1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059952"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. a -&gt; Ty a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TPair"><span class="hs-identifier hs-var">TPair</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059957"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059954"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059951"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059950"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679059952"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679059952"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Map AnnVar AnnVar -&gt; TySubst) -&gt; Map AnnVar AnnVar -&gt; TySubst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Map AnnVar AnnVar
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059960"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059957"><span class="hs-identifier hs-var">b2</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679059953"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059953"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059951"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059951"><span class="hs-identifier hs-var">left</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059952"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059959"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059952"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059956"><span class="hs-identifier hs-var">t3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679059954"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059954"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059950"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059950"><span class="hs-identifier hs-var">right</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059953"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059952"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059958"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059953"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059952"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059955"><span class="hs-identifier hs-var">t4</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span class="annot"><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TArrow"><span class="hs-identifier hs-type">TArrow</span></a></span><span> </span><span id="local-6989586621679059949"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059949"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059948"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059948"><span class="hs-identifier hs-var">a1</span></a></span></span><span> </span><span id="local-6989586621679059947"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059947"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621679059946"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059946"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TArrow"><span class="hs-identifier hs-type">TArrow</span></a></span><span> </span><span id="local-6989586621679059945"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059945"><span class="hs-identifier hs-var">t3</span></a></span></span><span> </span><span id="local-6989586621679059944"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059944"><span class="hs-identifier hs-var">a2</span></a></span></span><span> </span><span id="local-6989586621679059943"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059943"><span class="hs-identifier hs-var">b2</span></a></span></span><span> </span><span id="local-6989586621679059942"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059942"><span class="hs-identifier hs-var">t4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TySubst] -&gt; TySubst
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059941"><span class="hs-identifier hs-var">th2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059940"><span class="hs-identifier hs-var">th1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059939"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TArrow"><span class="hs-identifier hs-var">TArrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059941"><span class="hs-identifier hs-var">th2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059938"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059944"><span class="hs-identifier hs-var">a2</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059943"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059937"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-247"></span><span>    </span><span id="local-6989586621679059939"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679059939"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Map AnnVar AnnVar -&gt; TySubst) -&gt; Map AnnVar AnnVar -&gt; TySubst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(AnnVar, AnnVar)] -&gt; Map AnnVar AnnVar
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059947"><span class="hs-identifier hs-var">b1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059943"><span class="hs-identifier hs-var">b2</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059948"><span class="hs-identifier hs-var">a1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059944"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679059940"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059940"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059938"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059938"><span class="hs-identifier hs-var">left</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059939"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059949"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059939"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059945"><span class="hs-identifier hs-var">t3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679059941"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059941"><span class="hs-identifier hs-var">th2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059937"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059937"><span class="hs-identifier hs-var">right</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059940"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059939"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059946"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059940"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059939"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059942"><span class="hs-identifier hs-var">t4</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span class="annot"><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TList"><span class="hs-identifier hs-type">TList</span></a></span><span> </span><span id="local-6989586621679059936"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059936"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059935"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059935"><span class="hs-identifier hs-var">a1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TList"><span class="hs-identifier hs-type">TList</span></a></span><span> </span><span id="local-6989586621679059934"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059934"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span id="local-6989586621679059933"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059933"><span class="hs-identifier hs-var">a2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059932"><span class="hs-identifier hs-var">th1</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TySubst -&gt; TySubst
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059931"><span class="hs-identifier hs-var">th</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; Ty a
</span><a href="Type.html#TList"><span class="hs-identifier hs-var">TList</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059930"><span class="hs-identifier hs-var">t3</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059933"><span class="hs-identifier hs-var">a2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621679059931"><span class="annot"><span class="annottext">th :: TySubst
</span><a href="#local-6989586621679059931"><span class="hs-identifier hs-var hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Map AnnVar AnnVar -&gt; TySubst) -&gt; Map AnnVar AnnVar -&gt; TySubst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Map AnnVar AnnVar
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059935"><span class="hs-identifier hs-var">a1</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059933"><span class="hs-identifier hs-var">a2</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679059932"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059932"><span class="hs-identifier hs-var">th1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059930"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059930"><span class="hs-identifier hs-var">t3</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; Ty AnnVar -&gt; (TySubst, Ty AnnVar)
</span><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059931"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059936"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059931"><span class="hs-identifier hs-var">th</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059934"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span class="annot"><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#FreeVar"><span class="hs-identifier hs-type">FreeVar</span></a></span><span> </span><span id="local-6989586621679059929"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059929"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059928"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059928"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Ty AnnVar -&gt; TySubst -&gt; TySubst
forall a. TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
</span><a href="Type.html#chk"><span class="hs-identifier hs-var">chk</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059929"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059928"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Ty AnnVar -&gt; Map TyVar (Ty AnnVar)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059929"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059928"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059928"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span class="annot"><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span id="local-6989586621679059926"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059926"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#FreeVar"><span class="hs-identifier hs-type">FreeVar</span></a></span><span> </span><span id="local-6989586621679059925"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059925"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Ty AnnVar -&gt; TySubst -&gt; TySubst
forall a. TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
</span><a href="Type.html#chk"><span class="hs-identifier hs-var">chk</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059925"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059926"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Ty AnnVar -&gt; Map TyVar (Ty AnnVar)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059925"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059926"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059926"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span class="annot"><a href="Type.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span id="local-6989586621679059924"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059924"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059923"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059923"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (TySubst, Ty AnnVar)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot unify &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059924"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; ~ &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059923"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-comment">-- | Check whether the given type variable and type are unifiable.</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- This wrapper for @chk'@ ensures that @a@ unifies with @FreeVar a@,</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- while this would not unify after stripping of a type constructor, which would </span><span>
</span><span id="line-261"></span><span class="hs-comment">-- create an infinite type.</span><span>
</span><span id="line-262"></span><span id="local-6989586621679060465"><span class="annot"><a href="Type.html#chk"><span class="hs-identifier hs-type">chk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060465"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span></span><span>
</span><span id="line-263"></span><span id="chk"><span class="annot"><span class="annottext">chk :: TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
</span><a href="Type.html#chk"><span class="hs-identifier hs-var hs-var">chk</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#FreeVar"><span class="hs-identifier hs-type">FreeVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TySubst
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-264"></span><span class="annot"><a href="Type.html#chk"><span class="hs-identifier hs-var">chk</span></a></span><span> </span><span id="local-6989586621679059921"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059921"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059920"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059920"><span class="hs-identifier hs-var">b</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
forall a. TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
</span><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059921"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059920"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-comment">-- | Check whether the given type variable and type are unifiable.</span><span>
</span><span id="line-267"></span><span class="hs-comment">-- Note that @a@ cannot unify with @FreeVar a@ here, since this would indicate</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- the overall type becomes infinite.</span><span>
</span><span id="line-269"></span><span id="local-6989586621679059918"><span class="annot"><a href="Type.html#chk%27"><span class="hs-identifier hs-type">chk'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059918"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span></span><span>
</span><span id="line-270"></span><span id="chk%27"><span class="annot"><span class="annottext">chk' :: TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
</span><a href="Type.html#chk%27"><span class="hs-identifier hs-var hs-var">chk'</span></a></span></span><span> </span><span id="local-6989586621679059917"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059917"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#FreeVar"><span class="hs-identifier hs-type">FreeVar</span></a></span><span> </span><span id="local-6989586621679059916"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059916"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059915"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059915"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059917"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; TyVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059916"><span class="hs-identifier hs-var">b</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TySubst
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TySubst) -&gt; String -&gt; TySubst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059917"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; matches &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059916"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; in chk&quot;</span></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059915"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-273"></span><span class="annot"><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span id="local-6989586621679059914"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059914"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TArrow"><span class="hs-identifier hs-type">TArrow</span></a></span><span> </span><span id="local-6989586621679059913"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059913"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679059912"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059912"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059911"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059911"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
forall a. TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
</span><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059914"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059913"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
forall a. TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
</span><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059914"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059912"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059911"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span class="annot"><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span id="local-6989586621679059910"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059910"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TPair"><span class="hs-identifier hs-type">TPair</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679059909"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059909"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059908"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059908"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059907"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059907"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
forall a. TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
</span><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059910"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059909"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
forall a. TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
</span><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059910"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059908"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059907"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span class="annot"><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span id="local-6989586621679059906"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059906"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TList"><span class="hs-identifier hs-type">TList</span></a></span><span> </span><span id="local-6989586621679059905"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059905"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059904"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059904"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
forall a. TyVar -&gt; Ty a -&gt; TySubst -&gt; TySubst
</span><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059906"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059905"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059904"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-276"></span><span class="annot"><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span> </span><span id="local-6989586621679059903"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059903"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059903"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-277"></span><span class="annot"><a href="Type.html#chk%27"><span class="hs-identifier hs-var">chk'</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span><span> </span><span id="local-6989586621679059902"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059902"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059902"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- * helpers</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">-- | Create a fresh type variable.</span><span>
</span><span id="line-282"></span><span id="local-6989586621679060487"><span class="annot"><a href="Type.html#freshVar"><span class="hs-identifier hs-type">freshVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060487"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-283"></span><span id="freshVar"><span class="annot"><span class="annottext">freshVar :: State Integer (Ty a)
</span><a href="Type.html#freshVar"><span class="hs-identifier hs-var hs-var">freshVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; (Ty a, Integer)) -&gt; State Integer (Ty a)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; (a, s)) -&gt; m a
</span><span class="hs-identifier hs-var">state</span></span><span> </span><span class="annot"><span class="annottext">((Integer -&gt; (Ty a, Integer)) -&gt; State Integer (Ty a))
-&gt; (Integer -&gt; (Ty a, Integer)) -&gt; State Integer (Ty a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679059901"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679059901"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Ty a
forall a. TyVar -&gt; Ty a
</span><a href="Type.html#FreeVar"><span class="hs-identifier hs-var">FreeVar</span></a></span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; Ty a) -&gt; TyVar -&gt; Ty a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; TyVar
</span><a href="Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679059901"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679059901"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="hs-comment">-- | Create a fresh annotation variable.</span><span>
</span><span id="line-286"></span><span class="annot"><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-type">freshAnnVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span>
</span><span id="line-287"></span><span id="freshAnnVar"><span class="annot"><span class="annottext">freshAnnVar :: StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var hs-var">freshAnnVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; (AnnVar, Integer)) -&gt; StateT Integer Identity AnnVar
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; (a, s)) -&gt; m a
</span><span class="hs-identifier hs-var">state</span></span><span> </span><span class="annot"><span class="annottext">((Integer -&gt; (AnnVar, Integer)) -&gt; StateT Integer Identity AnnVar)
-&gt; (Integer -&gt; (AnnVar, Integer)) -&gt; StateT Integer Identity AnnVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679059899"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679059899"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; AnnVar
</span><a href="Type.html#AnnVar"><span class="hs-identifier hs-var">AnnVar</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679059899"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679059899"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="hs-comment">-- | For @as@, create an annotation variable @a@ and the constraints expressing that @a@ contains the union of @as@.  </span><span>
</span><span id="line-290"></span><span class="annot"><a href="Type.html#annUnion"><span class="hs-identifier hs-type">annUnion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span id="annUnion"><span class="annot"><span class="annottext">annUnion :: [AnnVar] -&gt; State Integer (AnnVar, Constrs)
</span><a href="Type.html#annUnion"><span class="hs-identifier hs-var hs-var">annUnion</span></a></span></span><span> </span><span id="local-6989586621679059898"><span class="annot"><span class="annottext">[AnnVar]
</span><a href="#local-6989586621679059898"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621679059897"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059897"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT Integer Identity AnnVar
</span><a href="Type.html#freshAnnVar"><span class="hs-identifier hs-var">freshAnnVar</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span class="annot"><span class="annottext">(AnnVar, Constrs) -&gt; State Integer (AnnVar, Constrs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059897"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Constr] -&gt; Constrs
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Constr] -&gt; Constrs) -&gt; [Constr] -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#Super"><span class="hs-identifier hs-var">Super</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059897"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnVar -&gt; Constr) -&gt; [AnnVar] -&gt; [Constr]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[AnnVar]
</span><a href="#local-6989586621679059898"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | @annNi a pi@ inserts the constraint expressing that @pi@ is in @a@.</span><span>
</span><span id="line-296"></span><span class="annot"><a href="Type.html#annNi"><span class="hs-identifier hs-type">annNi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ast.html#Pi"><span class="hs-identifier hs-type">Pi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span>
</span><span id="line-297"></span><span id="annNi"><span class="annot"><span class="annottext">annNi :: AnnVar -&gt; Integer -&gt; Constrs -&gt; Constrs
</span><a href="Type.html#annNi"><span class="hs-identifier hs-var hs-var">annNi</span></a></span></span><span> </span><span id="local-6989586621679059896"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059896"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059895"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679059895"><span class="hs-identifier hs-var">pi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Constrs -&gt; Constrs
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; FunId -&gt; Constr
</span><a href="Type.html#Ni"><span class="hs-identifier hs-var">Ni</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059896"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; FunId
</span><a href="Type.html#FunId"><span class="hs-identifier hs-var">FunId</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679059895"><span class="hs-identifier hs-var">pi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-- | Generalise and insert a variable into an environment.</span><span>
</span><span id="line-300"></span><span class="annot"><a href="Type.html#genIn"><span class="hs-identifier hs-type">genIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ast.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span>
</span><span id="line-301"></span><span id="genIn"><span class="annot"><span class="annottext">genIn :: String -&gt; Ty AnnVar -&gt; TyEnv -&gt; TyEnv
</span><a href="Type.html#genIn"><span class="hs-identifier hs-var hs-var">genIn</span></a></span></span><span> </span><span id="local-6989586621679059894"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679059894"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679059893"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059893"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679059892"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679059892"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TyScheme AnnVar -&gt; TyEnv -&gt; TyEnv
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679059894"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyEnv -&gt; Ty AnnVar -&gt; TyScheme AnnVar
forall a. TyEnv -&gt; Ty a -&gt; TyScheme a
</span><a href="Type.html#generalise"><span class="hs-identifier hs-var">generalise</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679059892"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059893"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679059892"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="hs-comment">-- | Instatiate a type scheme to a type by replacing all bound variables with fresh ones.</span><span>
</span><span id="line-304"></span><span class="annot"><a href="Type.html#cfaInstantiate"><span class="hs-identifier hs-type">cfaInstantiate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#TyScheme"><span class="hs-identifier hs-type">TyScheme</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span id="cfaInstantiate"><span class="annot"><span class="annottext">cfaInstantiate :: TyScheme AnnVar -&gt; State Integer (Ty AnnVar)
</span><a href="Type.html#cfaInstantiate"><span class="hs-identifier hs-var hs-var">cfaInstantiate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#SType"><span class="hs-identifier hs-type">SType</span></a></span><span> </span><span id="local-6989586621679059891"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059891"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; State Integer (Ty AnnVar)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059891"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-306"></span><span class="annot"><a href="Type.html#cfaInstantiate"><span class="hs-identifier hs-var">cfaInstantiate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Forall"><span class="hs-identifier hs-type">Forall</span></a></span><span> </span><span id="local-6989586621679059890"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059890"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679059889"><span class="annot"><span class="annottext">TyScheme AnnVar
</span><a href="#local-6989586621679059889"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>  </span><span id="local-6989586621679059888"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059888"><span class="hs-identifier hs-var">vFresh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State Integer (Ty AnnVar)
forall a. State Integer (Ty a)
</span><a href="Type.html#freshVar"><span class="hs-identifier hs-var">freshVar</span></a></span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Ty AnnVar -&gt; Map TyVar (Ty AnnVar)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059890"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059888"><span class="hs-identifier hs-var">vFresh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Ty AnnVar -&gt; Ty AnnVar)
-&gt; State Integer (Ty AnnVar) -&gt; State Integer (Ty AnnVar)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TyScheme AnnVar -&gt; State Integer (Ty AnnVar)
</span><a href="Type.html#cfaInstantiate"><span class="hs-identifier hs-var">cfaInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">TyScheme AnnVar
</span><a href="#local-6989586621679059889"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-comment">-- | Generalise a type to a type scheme by quantifying all variables which appear freely in the type and are unbound in the environment.</span><span>
</span><span id="line-311"></span><span id="local-6989586621679060512"><span class="annot"><a href="Type.html#generalise"><span class="hs-identifier hs-type">generalise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060512"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#TyScheme"><span class="hs-identifier hs-type">TyScheme</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060512"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-312"></span><span id="generalise"><span class="annot"><span class="annottext">generalise :: TyEnv -&gt; Ty a -&gt; TyScheme a
</span><a href="Type.html#generalise"><span class="hs-identifier hs-var hs-var">generalise</span></a></span></span><span> </span><span id="local-6989586621679059887"><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679059887"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679059886"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059886"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; TyScheme a -&gt; TyScheme a)
-&gt; TyScheme a -&gt; Set TyVar -&gt; TyScheme a
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Set a -&gt; b
</span><span class="hs-identifier hs-var">S.foldr</span></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; TyScheme a -&gt; TyScheme a
forall a. TyVar -&gt; TyScheme a -&gt; TyScheme a
</span><a href="Type.html#Forall"><span class="hs-identifier hs-var">Forall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty a -&gt; TyScheme a
forall a. Ty a -&gt; TyScheme a
</span><a href="Type.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059886"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ty a -&gt; Set TyVar
forall a. Ty a -&gt; Set TyVar
</span><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059886"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyVar -&gt; Set TyVar -&gt; Set TyVar
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.difference`</span></span><span> </span><span class="annot"><span class="annottext">TyEnv -&gt; Set TyVar
</span><a href="Type.html#envFreeVars"><span class="hs-identifier hs-var">envFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyEnv
</span><a href="#local-6989586621679059887"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><a href="Type.html#envFreeVars"><span class="hs-identifier hs-type">envFreeVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span>
</span><span id="line-315"></span><span id="envFreeVars"><span class="annot"><span class="annottext">envFreeVars :: TyEnv -&gt; Set TyVar
</span><a href="Type.html#envFreeVars"><span class="hs-identifier hs-var hs-var">envFreeVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyScheme AnnVar -&gt; Set TyVar) -&gt; TyEnv -&gt; Set TyVar
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">TyScheme AnnVar -&gt; Set TyVar
forall a. TyScheme a -&gt; Set TyVar
</span><a href="Type.html#schemeFreeVars"><span class="hs-identifier hs-var">schemeFreeVars</span></a></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span id="local-6989586621679060448"><span class="annot"><a href="Type.html#schemeFreeVars"><span class="hs-identifier hs-type">schemeFreeVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#TyScheme"><span class="hs-identifier hs-type">TyScheme</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060448"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span></span><span>
</span><span id="line-318"></span><span id="schemeFreeVars"><span class="annot"><span class="annottext">schemeFreeVars :: TyScheme a -&gt; Set TyVar
</span><a href="Type.html#schemeFreeVars"><span class="hs-identifier hs-var hs-var">schemeFreeVars</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#SType"><span class="hs-identifier hs-type">SType</span></a></span><span> </span><span id="local-6989586621679059879"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059879"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty a -&gt; Set TyVar
forall a. Ty a -&gt; Set TyVar
</span><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059879"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-319"></span><span class="annot"><a href="Type.html#schemeFreeVars"><span class="hs-identifier hs-var">schemeFreeVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Forall"><span class="hs-identifier hs-type">Forall</span></a></span><span> </span><span id="local-6989586621679059878"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059878"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679059877"><span class="annot"><span class="annottext">TyScheme a
</span><a href="#local-6989586621679059877"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Set TyVar -&gt; Set TyVar
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.delete</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059878"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">(Set TyVar -&gt; Set TyVar) -&gt; Set TyVar -&gt; Set TyVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyScheme a -&gt; Set TyVar
forall a. TyScheme a -&gt; Set TyVar
</span><a href="Type.html#schemeFreeVars"><span class="hs-identifier hs-var">schemeFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyScheme a
</span><a href="#local-6989586621679059877"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span id="local-6989586621679060452"><span class="annot"><a href="Type.html#freeVars"><span class="hs-identifier hs-type">freeVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060452"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span></span><span>
</span><span id="line-322"></span><span id="freeVars"><span class="annot"><span class="annottext">freeVars :: Ty a -&gt; Set TyVar
</span><a href="Type.html#freeVars"><span class="hs-identifier hs-var hs-var">freeVars</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#FreeVar"><span class="hs-identifier hs-type">FreeVar</span></a></span><span> </span><span id="local-6989586621679059875"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059875"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Set TyVar
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059875"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-323"></span><span class="annot"><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TArrow"><span class="hs-identifier hs-type">TArrow</span></a></span><span> </span><span id="local-6989586621679059873"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059873"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679059872"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059872"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty a -&gt; Set TyVar
forall a. Ty a -&gt; Set TyVar
</span><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059873"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyVar -&gt; Set TyVar -&gt; Set TyVar
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ty a -&gt; Set TyVar
forall a. Ty a -&gt; Set TyVar
</span><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059872"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-324"></span><span class="annot"><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TPair"><span class="hs-identifier hs-type">TPair</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679059871"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059871"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059870"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059870"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty a -&gt; Set TyVar
forall a. Ty a -&gt; Set TyVar
</span><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059871"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Set TyVar -&gt; Set TyVar -&gt; Set TyVar
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ty a -&gt; Set TyVar
forall a. Ty a -&gt; Set TyVar
</span><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059870"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-325"></span><span class="annot"><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TList"><span class="hs-identifier hs-type">TList</span></a></span><span> </span><span id="local-6989586621679059869"><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059869"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty a -&gt; Set TyVar
forall a. Ty a -&gt; Set TyVar
</span><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><a href="#local-6989586621679059869"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-326"></span><span class="annot"><a href="Type.html#freeVars"><span class="hs-identifier hs-var">freeVars</span></a></span><span> </span><span class="annot"><span class="annottext">Ty a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set TyVar
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">-- * substituting</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">{- | @Substitute a@ states that for each @s :: TySubst@, there is a meaningful substitution function @subst s :: a -&gt; a@.
In particular @subst@ should obey the identity laws

@subst mempty = id@

@subst (TySubst (M.singleton a (FreeVar a)) mempty) = id@

@subst (TySubst mempty (M.singleton a a)) = id@

and idempotence

@subst a . subst a = subst a@

(We could narrow down the description further with alpha-equivalence lemmas (e.g. injective substitutions are bijections, and preserve alpha-equivalence both ways),
but this is left as an exercise to the reader.)
-}</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="hs-keyword">class</span><span> </span><span id="Substitute"><span class="annot"><a href="Type.html#Substitute"><span class="hs-identifier hs-var">Substitute</span></a></span></span><span> </span><span id="local-6989586621679060507"><span class="annot"><a href="#local-6989586621679060507"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-348"></span><span>  </span><span id="subst"><span class="annot"><a href="Type.html#subst"><span class="hs-identifier hs-type">subst</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679060507"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679060507"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="hs-comment">-- | @substitute x s@ is the base case for most substitutions, replacing @x@ with its substitution if it is in @s@, and returning @x@ otherwise.</span><span>
</span><span id="line-351"></span><span id="local-6989586621679060443"><span class="annot"><a href="Type.html#substitute"><span class="hs-identifier hs-type">substitute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679060443"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679060443"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679060443"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679060443"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679060443"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-352"></span><span id="substitute"><span class="annot"><span class="annottext">substitute :: a -&gt; Map a a -&gt; a
</span><a href="Type.html#substitute"><span class="hs-identifier hs-var hs-var">substitute</span></a></span></span><span> </span><span id="local-6989586621679059867"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059867"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Map a a -&gt; a
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059867"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059867"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Type.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-355"></span><span>  </span><span id="local-6989586621679059864"><span class="annot"><span class="annottext">subst :: TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
</span><a href="#local-6989586621679059864"><span class="hs-identifier hs-var hs-var hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span id="local-6989586621679059863"><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><a href="#local-6989586621679059863"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#FreeVar"><span class="hs-identifier hs-type">FreeVar</span></a></span><span> </span><span id="local-6989586621679059862"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059862"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; TyVar -&gt; Map TyVar (Ty AnnVar) -&gt; Ty AnnVar
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">findWithDefault</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Ty AnnVar
forall a. TyVar -&gt; Ty a
</span><a href="Type.html#FreeVar"><span class="hs-identifier hs-var">FreeVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059862"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059862"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><a href="#local-6989586621679059863"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
forall a. Ty a
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
forall a. Ty a
</span><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span><span>
</span><span id="line-358"></span><span>  </span><span class="annot"><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span id="local-6989586621679059861"><span class="annot"><span class="annottext">s :: TySubst
</span><a href="#local-6989586621679059861"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679059860"><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059860"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TArrow"><span class="hs-identifier hs-type">TArrow</span></a></span><span> </span><span id="local-6989586621679059859"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059859"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059858"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059858"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059857"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059857"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679059856"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059856"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TArrow"><span class="hs-identifier hs-var">TArrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059861"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059859"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Map AnnVar AnnVar -&gt; AnnVar
forall a. Ord a =&gt; a -&gt; Map a a -&gt; a
</span><a href="Type.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059858"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059860"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Map AnnVar AnnVar -&gt; AnnVar
forall a. Ord a =&gt; a -&gt; Map a a -&gt; a
</span><a href="Type.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059857"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059860"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059861"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059856"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span id="local-6989586621679059855"><span class="annot"><span class="annottext">s :: TySubst
</span><a href="#local-6989586621679059855"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679059854"><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059854"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TPair"><span class="hs-identifier hs-type">TPair</span></a></span><span> </span><span id="local-6989586621679059853"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059853"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059852"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059852"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059851"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059851"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. a -&gt; Ty a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TPair"><span class="hs-identifier hs-var">TPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Map AnnVar AnnVar -&gt; AnnVar
forall a. Ord a =&gt; a -&gt; Map a a -&gt; a
</span><a href="Type.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059853"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059854"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059855"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059852"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059855"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059851"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>  </span><span class="annot"><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span id="local-6989586621679059850"><span class="annot"><span class="annottext">s :: TySubst
</span><a href="#local-6989586621679059850"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679059849"><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059849"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TList"><span class="hs-identifier hs-type">TList</span></a></span><span> </span><span id="local-6989586621679059848"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059848"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679059847"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059847"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; AnnVar -&gt; Ty AnnVar
forall a. Ty a -&gt; a -&gt; Ty a
</span><a href="Type.html#TList"><span class="hs-identifier hs-var">TList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059850"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059848"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Map AnnVar AnnVar -&gt; AnnVar
forall a. Ord a =&gt; a -&gt; Map a a -&gt; a
</span><a href="Type.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059847"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059849"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">-- | Notably, the @TyScheme@ instance is the only substitution which alters the substition as it is passed down,</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- removing substitutions on variables which are bound to quantifiers.</span><span>
</span><span id="line-364"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Type.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TyScheme"><span class="hs-identifier hs-type">TyScheme</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-365"></span><span>  </span><span id="local-6989586621679059845"><span class="annot"><span class="annottext">subst :: TySubst -&gt; TyScheme AnnVar -&gt; TyScheme AnnVar
</span><a href="#local-6989586621679059845"><span class="hs-identifier hs-var hs-var hs-var hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621679059844"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059844"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#SType"><span class="hs-identifier hs-type">SType</span></a></span><span> </span><span id="local-6989586621679059843"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059843"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty AnnVar -&gt; TyScheme AnnVar
forall a. Ty a -&gt; TyScheme a
</span><a href="Type.html#SType"><span class="hs-identifier hs-var">SType</span></a></span><span> </span><span class="annot"><span class="annottext">(Ty AnnVar -&gt; TyScheme AnnVar) -&gt; Ty AnnVar -&gt; TyScheme AnnVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059844"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059843"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-366"></span><span>  </span><span class="annot"><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span id="local-6989586621679059842"><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><a href="#local-6989586621679059842"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679059841"><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059841"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Forall"><span class="hs-identifier hs-type">Forall</span></a></span><span> </span><span id="local-6989586621679059840"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059840"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621679059839"><span class="annot"><span class="annottext">TyScheme AnnVar
</span><a href="#local-6989586621679059839"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; TyScheme AnnVar -&gt; TyScheme AnnVar
forall a. TyVar -&gt; TyScheme a -&gt; TyScheme a
</span><a href="Type.html#Forall"><span class="hs-identifier hs-var">Forall</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059840"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TyScheme AnnVar -&gt; TyScheme AnnVar)
-&gt; TyScheme AnnVar -&gt; TyScheme AnnVar
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; TyScheme AnnVar -&gt; TyScheme AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Map TyVar (Ty AnnVar) -&gt; Map TyVar (Ty AnnVar)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.delete</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059840"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><a href="#local-6989586621679059842"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059841"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyScheme AnnVar
</span><a href="#local-6989586621679059839"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Type.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="Type.html#TyEnv"><span class="hs-identifier hs-type">TyEnv</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-369"></span><span>  </span><span id="local-6989586621679059836"><span class="annot"><span class="annottext">subst :: TySubst -&gt; TyEnv -&gt; TyEnv
</span><a href="#local-6989586621679059836"><span class="hs-identifier hs-var hs-var hs-var hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621679059835"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059835"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyScheme AnnVar -&gt; TyScheme AnnVar) -&gt; TyEnv -&gt; TyEnv
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; TyScheme AnnVar -&gt; TyScheme AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059835"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Type.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-372"></span><span>  </span><span id="local-6989586621679059833"><span class="annot"><span class="annottext">subst :: TySubst -&gt; AnnVar -&gt; AnnVar
</span><a href="#local-6989586621679059833"><span class="hs-identifier hs-var hs-var hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679059832"><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059832"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059831"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059831"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Map AnnVar AnnVar -&gt; AnnVar
forall a. Ord a =&gt; a -&gt; Map a a -&gt; a
</span><a href="Type.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059831"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059832"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Type.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="Type.html#Constr"><span class="hs-identifier hs-type">Constr</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-375"></span><span>  </span><span id="local-6989586621679059829"><span class="annot"><span class="annottext">subst :: TySubst -&gt; Constr -&gt; Constr
</span><a href="#local-6989586621679059829"><span class="hs-identifier hs-var hs-var hs-var hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621679059828"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059828"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ni"><span class="hs-identifier hs-type">Ni</span></a></span><span> </span><span id="local-6989586621679059827"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059827"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679059826"><span class="annot"><span class="annottext">FunId
</span><a href="#local-6989586621679059826"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; FunId -&gt; Constr
</span><a href="Type.html#Ni"><span class="hs-identifier hs-var">Ni</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; AnnVar -&gt; AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059828"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059827"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FunId
</span><a href="#local-6989586621679059826"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span id="local-6989586621679059825"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059825"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Super"><span class="hs-identifier hs-type">Super</span></a></span><span> </span><span id="local-6989586621679059824"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059824"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059823"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059823"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Constr
</span><a href="Type.html#Super"><span class="hs-identifier hs-var">Super</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; AnnVar -&gt; AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059825"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059824"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; AnnVar -&gt; AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059825"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059823"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span id="local-6989586621679059822"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679059822"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059822"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Type.html#Substitute"><span class="hs-identifier hs-type">Substitute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679059822"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-379"></span><span>  </span><span id="local-6989586621679059820"><span class="annot"><span class="annottext">subst :: TySubst -&gt; Set a -&gt; Set a
</span><a href="#local-6989586621679059820"><span class="hs-identifier hs-var hs-var hs-var hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621679059819"><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059819"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; Set a -&gt; Set a
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; a -&gt; a
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059819"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679059813"><span id="local-6989586621679059815"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-382"></span><span>  </span><span id="local-6989586621679059811"><span class="annot"><span class="annottext">s'' :: TySubst
</span><a href="#local-6989586621679059811"><span class="hs-identifier hs-var">s''</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span id="local-6989586621679059810"><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><a href="#local-6989586621679059810"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679059809"><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059809"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059808"><span class="annot"><span class="annottext">&lt;&gt; :: TySubst -&gt; TySubst -&gt; TySubst
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span> </span><span id="local-6989586621679059807"><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><a href="#local-6989586621679059807"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679059806"><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059806"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ty AnnVar -&gt; Ty AnnVar)
-&gt; Map TyVar (Ty AnnVar) -&gt; Map TyVar (Ty AnnVar)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; Ty AnnVar -&gt; Ty AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059811"><span class="hs-identifier hs-var">s''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><a href="#local-6989586621679059807"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
-&gt; Map TyVar (Ty AnnVar) -&gt; Map TyVar (Ty AnnVar)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`M.union`</span></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
</span><a href="#local-6989586621679059810"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnVar -&gt; AnnVar) -&gt; Map AnnVar AnnVar -&gt; Map AnnVar AnnVar
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst -&gt; AnnVar -&gt; AnnVar
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059811"><span class="hs-identifier hs-var">s''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059806"><span class="hs-identifier hs-var">t'</span></a></span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar -&gt; Map AnnVar AnnVar -&gt; Map AnnVar AnnVar
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`M.union`</span></span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
</span><a href="#local-6989586621679059809"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span class="hs-comment">-- | The @TySubst@ monoid has multiplication as substitution composition,</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- satisfying @subst (s2 &lt;&gt; s1) x = subst s2 $ subst s1 x@.</span><span>
</span><span id="line-386"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679059800"><span id="local-6989586621679059802"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-387"></span><span>  </span><span id="local-6989586621679059798"><span class="annot"><span class="annottext">mempty :: TySubst
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Map AnnVar AnnVar
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-comment">-- * constraints solving</span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="hs-comment">-- | Return the substitution and simplified constraint set, formed by removing all cyclic components and substituting all variables in such components to a representative.</span><span>
</span><span id="line-392"></span><span class="annot"><a href="Type.html#simplify"><span class="hs-identifier hs-type">simplify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TySubst"><span class="hs-identifier hs-type">TySubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span id="simplify"><span class="annot"><span class="annottext">simplify :: Constrs -&gt; (TySubst, Constrs)
</span><a href="Type.html#simplify"><span class="hs-identifier hs-var hs-var">simplify</span></a></span></span><span> </span><span id="local-6989586621679059797"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059797"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059796"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059795"><span class="hs-identifier hs-var">cs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-395"></span><span>    </span><span id="local-6989586621679059794"><span class="annot"><span class="annottext">ss :: [[AnnVar]]
</span><a href="#local-6989586621679059794"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SCC AnnVar -&gt; [AnnVar]
forall vertex. SCC vertex -&gt; [vertex]
</span><span class="hs-identifier hs-var">flattenSCC</span></span><span> </span><span class="annot"><span class="annottext">(SCC AnnVar -&gt; [AnnVar]) -&gt; [SCC AnnVar] -&gt; [[AnnVar]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(AnnVar, AnnVar, [AnnVar])] -&gt; [SCC AnnVar]
forall key node. Ord key =&gt; [(node, key, [key])] -&gt; [SCC node]
</span><span class="hs-identifier hs-var">stronglyConnComp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constrs -&gt; [(AnnVar, AnnVar, [AnnVar])]
</span><a href="Type.html#toGraph"><span class="hs-identifier hs-var">toGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059797"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>    </span><span id="local-6989586621679059792"><span class="annot"><span class="annottext">f :: [AnnVar] -&gt; TySubst
</span><a href="#local-6989586621679059792"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679059791"><span class="annot"><span class="annottext">[AnnVar]
</span><a href="#local-6989586621679059791"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar) -&gt; Map AnnVar AnnVar -&gt; TySubst
</span><a href="Type.html#TySubst"><span class="hs-identifier hs-var">TySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Map TyVar (Ty AnnVar)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Map AnnVar AnnVar -&gt; TySubst) -&gt; Map AnnVar AnnVar -&gt; TySubst
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(AnnVar, AnnVar)] -&gt; Map AnnVar AnnVar
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059790"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AnnVar] -&gt; AnnVar
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[AnnVar]
</span><a href="#local-6989586621679059791"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679059790"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059790"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[AnnVar] -&gt; [AnnVar]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[AnnVar]
</span><a href="#local-6989586621679059791"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621679059796"><span class="annot"><span class="annottext">s :: TySubst
</span><a href="#local-6989586621679059796"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([AnnVar] -&gt; TySubst) -&gt; [[AnnVar]] -&gt; TySubst
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">[AnnVar] -&gt; TySubst
</span><a href="#local-6989586621679059792"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[[AnnVar]]
</span><a href="#local-6989586621679059794"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span id="local-6989586621679059795"><span class="annot"><span class="annottext">cs' :: Constrs
</span><a href="#local-6989586621679059795"><span class="hs-identifier hs-var hs-var">cs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; Constrs
</span><a href="Type.html#deloop"><span class="hs-identifier hs-var">deloop</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Constrs) -&gt; Constrs -&gt; Constrs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TySubst -&gt; Constrs -&gt; Constrs
forall a. Substitute a =&gt; TySubst -&gt; a -&gt; a
</span><a href="Type.html#subst"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TySubst
</span><a href="#local-6989586621679059796"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059797"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-comment">-- | Convert a set of constraints to the constraint graph,</span><span>
</span><span id="line-401"></span><span class="hs-comment">-- in which a directed edge @a-&gt;b@ indicates a subset relation @a &lt;= b@.</span><span>
</span><span id="line-402"></span><span class="annot"><a href="Type.html#toGraph"><span class="hs-identifier hs-type">toGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-403"></span><span id="toGraph"><span class="annot"><span class="annottext">toGraph :: Constrs -&gt; [(AnnVar, AnnVar, [AnnVar])]
</span><a href="Type.html#toGraph"><span class="hs-identifier hs-var hs-var">toGraph</span></a></span></span><span> </span><span id="local-6989586621679059786"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059786"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059785"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059785"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[AnnVar]
</span><a href="#local-6989586621679059784"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679059785"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059785"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059784"><span class="annot"><span class="annottext">[AnnVar]
</span><a href="#local-6989586621679059784"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map AnnVar [AnnVar] -&gt; [(AnnVar, [AnnVar])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map AnnVar [AnnVar]
</span><a href="#local-6989586621679059782"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-405"></span><span>    </span><span id="local-6989586621679059782"><span class="annot"><span class="annottext">es :: Map AnnVar [AnnVar]
</span><a href="#local-6989586621679059782"><span class="hs-identifier hs-var hs-var">es</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Constr -&gt; Map AnnVar [AnnVar] -&gt; Map AnnVar [AnnVar])
-&gt; Map AnnVar [AnnVar] -&gt; Constrs -&gt; Map AnnVar [AnnVar]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Set a -&gt; b
</span><span class="hs-identifier hs-var">S.foldr</span></span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Map AnnVar [AnnVar] -&gt; Map AnnVar [AnnVar]
</span><a href="#local-6989586621679059781"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">Map AnnVar [AnnVar]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059786"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>    </span><span id="local-6989586621679059780"><span class="annot"><span class="annottext">addEdge :: a -&gt; Maybe [a] -&gt; Maybe [a]
</span><a href="#local-6989586621679059780"><span class="hs-identifier hs-var hs-var">addEdge</span></a></span></span><span> </span><span id="local-6989586621679059779"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059779"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679059778"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059778"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Maybe [a]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059779"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059778"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><a href="#local-6989586621679059780"><span class="hs-identifier hs-var">addEdge</span></a></span><span> </span><span id="local-6989586621679059777"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059777"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe [a]
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Maybe [a]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059777"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621679059781"><span class="annot"><span class="annottext">collect :: Constr -&gt; Map AnnVar [AnnVar] -&gt; Map AnnVar [AnnVar]
</span><a href="#local-6989586621679059781"><span class="hs-identifier hs-var hs-var">collect</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Super"><span class="hs-identifier hs-type">Super</span></a></span><span> </span><span id="local-6989586621679059776"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059776"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059775"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059775"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe [AnnVar] -&gt; Maybe [AnnVar])
-&gt; AnnVar -&gt; Map AnnVar [AnnVar] -&gt; Map AnnVar [AnnVar]
forall k a.
Ord k =&gt;
(Maybe a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.alter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Maybe [AnnVar] -&gt; Maybe [AnnVar]
forall a. a -&gt; Maybe [a] -&gt; Maybe [a]
</span><a href="#local-6989586621679059780"><span class="hs-identifier hs-var">addEdge</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059775"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059776"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><a href="#local-6989586621679059781"><span class="hs-identifier hs-var">collect</span></a></span><span> </span><span class="annot"><span class="annottext">Constr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map AnnVar [AnnVar] -&gt; Map AnnVar [AnnVar]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span class="hs-comment">-- | Remove all constraint loops of the form @Super a a@.</span><span>
</span><span id="line-414"></span><span class="annot"><a href="Type.html#deloop"><span class="hs-identifier hs-type">deloop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span>
</span><span id="line-415"></span><span id="deloop"><span class="annot"><span class="annottext">deloop :: Constrs -&gt; Constrs
</span><a href="Type.html#deloop"><span class="hs-identifier hs-var hs-var">deloop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Constr] -&gt; Constrs
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Constr] -&gt; Constrs)
-&gt; (Constrs -&gt; [Constr]) -&gt; Constrs -&gt; Constrs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Constr -&gt; Maybe Constr) -&gt; [Constr] -&gt; [Constr]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Maybe Constr
</span><a href="#local-6989586621679059772"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">([Constr] -&gt; [Constr])
-&gt; (Constrs -&gt; [Constr]) -&gt; Constrs -&gt; [Constr]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; [Constr]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-417"></span><span>    </span><span id="local-6989586621679059772"><span class="annot"><span class="annottext">f :: Constr -&gt; Maybe Constr
</span><a href="#local-6989586621679059772"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679059770"><span class="annot"><span class="annottext">x :: Constr
</span><a href="#local-6989586621679059770"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Super"><span class="hs-identifier hs-type">Super</span></a></span><span> </span><span id="local-6989586621679059769"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059769"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059768"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059768"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059769"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059768"><span class="hs-identifier hs-var">b</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Constr
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Maybe Constr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Constr
</span><a href="#local-6989586621679059770"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span class="annot"><a href="#local-6989586621679059772"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span id="local-6989586621679059767"><span class="annot"><span class="annottext">Constr
</span><a href="#local-6989586621679059767"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Maybe Constr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Constr
</span><a href="#local-6989586621679059767"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="hs-comment">-- | Greedily solve a set of constraints for the least solution.</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- Loops when the constraints contain a cyclic component.</span><span>
</span><span id="line-424"></span><span class="annot"><a href="Type.html#solveConstraints"><span class="hs-identifier hs-type">solveConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Type.html#Constrs"><span class="hs-identifier hs-type">Constrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-425"></span><span id="solveConstraints"><span class="annot"><span class="annottext">solveConstraints :: Constrs -&gt; AnnVar -&gt; Ann
</span><a href="Type.html#solveConstraints"><span class="hs-identifier hs-var hs-var">solveConstraints</span></a></span></span><span> </span><span id="local-6989586621679059766"><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059766"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span id="local-6989586621679059765"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059765"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Ann -&gt; Ann
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">S.unions</span></span><span> </span><span class="annot"><span class="annottext">(Set Ann -&gt; Ann) -&gt; Set Ann -&gt; Ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Constr -&gt; Ann) -&gt; Constrs -&gt; Set Ann
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Ann
</span><a href="#local-6989586621679059764"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">(Constrs -&gt; Set Ann) -&gt; Constrs -&gt; Set Ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Constr -&gt; Bool) -&gt; Constrs -&gt; Constrs
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.filter</span></span><span> </span><span class="annot"><span class="annottext">Constr -&gt; Bool
</span><a href="#local-6989586621679059762"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059766"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-427"></span><span>    </span><span id="local-6989586621679059762"><span class="annot"><span class="annottext">f :: Constr -&gt; Bool
</span><a href="#local-6989586621679059762"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ni"><span class="hs-identifier hs-type">Ni</span></a></span><span> </span><span id="local-6989586621679059761"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059761"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">FunId
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059765"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059761"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span class="annot"><a href="#local-6989586621679059762"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Super"><span class="hs-identifier hs-type">Super</span></a></span><span> </span><span id="local-6989586621679059760"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059760"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059765"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; AnnVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059760"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621679059764"><span class="annot"><span class="annottext">g :: Constr -&gt; Ann
</span><a href="#local-6989586621679059764"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Ni"><span class="hs-identifier hs-type">Ni</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679059759"><span class="annot"><span class="annottext">FunId
</span><a href="#local-6989586621679059759"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FunId -&gt; Ann
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="annot"><span class="annottext">FunId
</span><a href="#local-6989586621679059759"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><a href="#local-6989586621679059764"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#Super"><span class="hs-identifier hs-type">Super</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679059758"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059758"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constrs -&gt; AnnVar -&gt; Ann
</span><a href="Type.html#solveConstraints"><span class="hs-identifier hs-var">solveConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">Constrs
</span><a href="#local-6989586621679059766"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059758"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="annot"><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-type">replaceAnnVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#AnnVar"><span class="hs-identifier hs-type">AnnVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Type.html#Ty"><span class="hs-identifier hs-type">Ty</span></a></span><span> </span><span class="annot"><a href="Type.html#Ann"><span class="hs-identifier hs-type">Ann</span></a></span><span>
</span><span id="line-434"></span><span id="replaceAnnVar"><span class="annot"><span class="annottext">replaceAnnVar :: (AnnVar -&gt; Ann) -&gt; Ty AnnVar -&gt; Ty Ann
</span><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var hs-var">replaceAnnVar</span></a></span></span><span> </span><span id="local-6989586621679059757"><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059757"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TArrow"><span class="hs-identifier hs-type">TArrow</span></a></span><span> </span><span id="local-6989586621679059756"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059756"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059755"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059755"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059754"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059754"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679059753"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059753"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty Ann -&gt; Ann -&gt; Ann -&gt; Ty Ann -&gt; Ty Ann
forall a. Ty a -&gt; a -&gt; a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TArrow"><span class="hs-identifier hs-var">TArrow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnVar -&gt; Ann) -&gt; Ty AnnVar -&gt; Ty Ann
</span><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059757"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059756"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059757"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059755"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059757"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059754"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnVar -&gt; Ann) -&gt; Ty AnnVar -&gt; Ty Ann
</span><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059757"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059753"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span class="annot"><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#FreeVar"><span class="hs-identifier hs-type">FreeVar</span></a></span><span> </span><span id="local-6989586621679059752"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059752"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Ty Ann
forall a. TyVar -&gt; Ty a
</span><a href="Type.html#FreeVar"><span class="hs-identifier hs-var">FreeVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679059752"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-436"></span><span class="annot"><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty Ann
forall a. Ty a
</span><a href="Type.html#TInt"><span class="hs-identifier hs-var">TInt</span></a></span><span>
</span><span id="line-437"></span><span class="annot"><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty Ann
forall a. Ty a
</span><a href="Type.html#TBool"><span class="hs-identifier hs-var">TBool</span></a></span><span>
</span><span id="line-438"></span><span class="annot"><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span id="local-6989586621679059751"><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059751"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TPair"><span class="hs-identifier hs-type">TPair</span></a></span><span> </span><span id="local-6989586621679059750"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059750"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679059749"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059749"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679059748"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059748"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Ty Ann -&gt; Ty Ann -&gt; Ty Ann
forall a. a -&gt; Ty a -&gt; Ty a -&gt; Ty a
</span><a href="Type.html#TPair"><span class="hs-identifier hs-var">TPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059751"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059750"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnVar -&gt; Ann) -&gt; Ty AnnVar -&gt; Ty Ann
</span><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059751"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059749"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnVar -&gt; Ann) -&gt; Ty AnnVar -&gt; Ty Ann
</span><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059751"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059748"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span class="annot"><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span id="local-6989586621679059747"><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059747"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Type.html#TList"><span class="hs-identifier hs-type">TList</span></a></span><span> </span><span id="local-6989586621679059746"><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059746"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679059745"><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059745"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ty Ann -&gt; Ann -&gt; Ty Ann
forall a. Ty a -&gt; a -&gt; Ty a
</span><a href="Type.html#TList"><span class="hs-identifier hs-var">TList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AnnVar -&gt; Ann) -&gt; Ty AnnVar -&gt; Ty Ann
</span><a href="Type.html#replaceAnnVar"><span class="hs-identifier hs-var">replaceAnnVar</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059747"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Ty AnnVar
</span><a href="#local-6989586621679059746"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnnVar -&gt; Ann
</span><a href="#local-6989586621679059747"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">AnnVar
</span><a href="#local-6989586621679059745"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span></pre></body></html>